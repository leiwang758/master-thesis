self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.3.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[3],{316:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return a}));var r=n(187),o=null,c=3e4;function i(){return null==o&&(o=new r.Cache),o}function u(e){return i().get(e)}function s(e){return i().del(e)}function a(e,t){i().put(e,t,c)}},458:function(e,t,n){"use strict";var r=n(0),o=n(187),c=n(293),i=n(349);function u(e){return Object(r.__assign)({__type:"TokenRequest:#Exchange"},e)}var s=n(111),a=n(29);function l(e,t){return void 0===e||e.__type||(e=u(e)),Object(a.a)("GetAccessTokenforResource",e,t)}var d=n(322),f=n(186),h="OWA_GetAccessTokenForResource";function _(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,Object(d.a)()];case 1:return(o=r.sent())&&e==Object(f.a)()?[2,{AccessToken:o}]:(c={isUserActivity:!1,datapoint:{customData:{Scenario:h,Resource_Url:e,Retry_attempt:t,Request_Id:n},headersCustomData:function(e){return{TokenResultDetails:e.get("x-tokenresult")||""}},jsonCustomData:function(e){var t;return{TokenStatus:(null===(t=null==e?void 0:e.TokenResultCode)||void 0===t?void 0:t.toString())||2}}},returnFullResponseOnSuccess:!0},[4,l(u({Resource:e,UserToken:o}),c)]);case 2:return[4,r.sent().json()];case 3:return[2,r.sent()]}}))}))}function b(e,t,n,o){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){return t<1?[2,Promise.reject()]:[2,_(e,t,o).catch((function(r){return Object(s.a)(n).then((function(){return b(e,t-1,2*n,o)}))}))]}))}))}var v,p=n(77),O=n(447),g=3,k=500;function j(e,t){return new Promise((function(n,r){(null==v&&(v=new O.a(g,A,k)),v).add({onFulfilled:n,onRejected:r,resource:e,requestId:t})}))}function A(e){return q(e.resource,e.requestId).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),Promise.resolve()}var w=n(316),T=n(72),m=n(361);n.d(t,"b",(function(){return D})),n.d(t,"c",(function(){return E})),n.d(t,"a",(function(){return q}));var I=1,y=8e3,C=3,R=1500,S=null;function D(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=x(U(),e),t=t||Object(m.a)(),null!=n?[3,2]:[4,q(e,t)];case 1:n=r.sent(),r.label=2;case 2:return[2,null!=n?n.AccessToken:void 0]}}))}))}function E(e,t){t=t||Object(m.a)();var n=x(U(),e);if(n)return[n.AccessToken,void 0];if(Object(p.i)("auth-getAccessTokenQueueEnabled")){var r=Object(w.a)(e),o=void 0;return r?o=r:(o=j(e,t),Object(w.b)(e,o)),[void 0,o.then((function(t){return Object(w.c)(e),t.AccessToken})).catch((function(n){Object(w.c)(e),Object(T.h)(h,{category:"Promise_For_Token_Request_Failed",err:n?n.toString():"",message:n?n.message:"",stk:n?n.stack:"",resource:e,requestId:t})}))]}return[void 0,q(e,t).then((function(e){return e.AccessToken}))]}function q(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,o,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return Object(p.i)("auth-getAccessTokenQueueEnabled")?[4,b(e,C,R,t)]:[3,2];case 1:return o=r.sent(),[3,4];case 2:return[4,_(e,C,t)];case 3:o=r.sent(),r.label=4;case 4:return null!=(n=o)&&0==n.TokenResultCode&&null!=n.AccessTokenExpiry&&(n.ExpiresIn&&n.ExpiresIn>0&&(n.AccessTokenExpiry=Object(i.a)(Date.now(),n.ExpiresIn).toISOString()),(c=new Date(n.AccessTokenExpiry).getTime()-Date.now()-y)>0&&U().put(e,n,c,(function(e,n){q(e,t).catch((function(n){Object(T.h)(h,{category:"Cache_Expired",err:n?n.toString():"",message:n?n.message:"",stk:n?n.stack:"",resource:e,requestId:t})}))}))),[2,n]}}))}))}function x(e,t){var n=e.get(t),r=void 0;(null==n?void 0:n.AccessTokenExpiry)&&n.AccessToken&&(Object(c.a)(new Date(n.AccessTokenExpiry),-I)>new Date(Date.now())&&(r=n));return r}function U(){return null==S&&(S=new o.Cache),S}},472:function(e,t,n){"use strict";n.r(t);var r=n(458),o=n(0),c=n(187),i=n(315),u=n(108),s=n(349),a=n(72),l="OWA_GetDelegationAccessToken",d={};function f(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:t=encodeURIComponent(e.client_id+e.scope+e.requestId),n={},r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,h(e,window,t)];case 2:return n=r.sent(),[3,5];case 3:return r.sent(),n.TokenResultCode=2,[3,5];case 4:return function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",d[e]),t.document.body.removeChild(n),delete d[e])}(t,window),[7];case 5:return[2,n]}}))}))}function h(e,t,n){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,c;return Object(o.__generator)(this,(function(o){return r=function(e){var t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+i.stringify(t)}(e),t.document.getElementById(n)?[2,{TokenResultCode:2}]:((c=t.document.createElement("iframe")).src=r.toString(),c.style.display="none",c.id=n,t.document.body.appendChild(c),[2,new Promise((function(r,o){d[n]=function(n){var u={};try{c.contentWindow&&c.contentWindow.location.host==t.location.host&&(u=function(e,t){var n=i.parse(e),r={};n.access_token?(r.AccessToken=n.access_token,r.AccessTokenExpiry=Object(s.a)(Date.now(),parseInt(n.expires_in)).toISOString(),r.TokenResultCode=0):"login_required"==n.error||"interaction_required"==n.error||"consent_required"==n.error?(r.TokenResultCode=3,Object(a.h)(l+" MSA Failure Unauthorized",{error:n.error,param:e,requestId:t})):(r.TokenResultCode=2,Object(a.h)(l+" MSA Failure",{error:n.error,param:e,requestId:t}));return r}(c.contentWindow.location.hash.substring(1),e.requestId))}catch(t){Object(a.h)(l+" Hash Param Parsing Failure ",{err:t.toString(),message:t.message,stk:t.stack||"",scope:e.scope,uri:e.redirect_uri,requestId:e.requestId}),u.TokenResultCode=2,o(u)}r(u)},c.addEventListener("load",d[n],!1)}))])}))}))}var _,b=n(77),v=n(316),p=n(447),O=3,g=1500;function k(e){return new Promise((function(t,n){(null==_&&(_=new p.a(O,j,g)),_).add({onFulfilled:t,onRejected:n,options:e})}))}function j(e){return f(e.options).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),Promise.resolve()}var A=n(186),w=n(361),T=null,m="OWA_GetDelegationAccessToken",I="https://login.live.com/oauth20_authorize.srf",y="/owa/auth/dt.aspx",C="292841";function R(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,r,c,s,l;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:n={scope:e,client_id:"",authorization_uri:"",redirect_uri:"",requestId:t||Object(w.a)()},o.label=1;case 1:return o.trys.push([1,7,,8]),Object(b.i)("auth-disableGetAuthenticationCall")?[4,S(q(n))]:[3,3];case 2:return r=o.sent(),[3,6];case 3:return[4,Object(u.a)({})];case 4:return 0!=(c=o.sent()).ResultCode||null==c.ImplicitGrantAuthorizationUrl||""==c.ImplicitGrantAuthorizationUrl?(Object(a.h)(m+" ImplicitGrantAuthorizationUrl is empty or null ",{scope:e,correlationId:n.requestId}),[2,r]):(s=i.parse(c.ImplicitGrantAuthorizationUrl.split("?")[1]||"")).client_id&&s.redirect_uri?(n.client_id=s.client_id,n.authorization_uri=c.ImplicitGrantAuthorizationUrl.split("?")[0],n.redirect_uri=s.redirect_uri,[4,S(n)]):[3,6];case 5:r=o.sent(),o.label=6;case 6:return[2,r];case 7:return l=o.sent(),Object(a.h)(m+" GetDelegationToken Operation failed ",{err:l.toString(),message:l.message,stk:l.stack||"",scope:e,requestId:n.requestId}),[2,r];case 8:return[2]}}))}))}function S(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n,r,c;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return t=e.client_id+e.scope,(null==(n=function(e,t){var n=e.get(t),r=void 0;if(null==n?void 0:n.AccessTokenExpiry){new Date(n.AccessTokenExpiry)>new Date(Date.now())&&(r=n)}return r}(E(),t))?void 0:n.AccessToken)?[2,n.AccessToken]:[3,1];case 1:return Object(b.i)("auth-getDelegationTokenQueueEnabled")?(r=Object(v.a)(t),c=void 0,r?c=r:(c=k(e),Object(v.b)(t,c)),[2,c.then((function(e){return D(t,e),Object(v.c)(t),e.AccessToken})).catch((function(n){Object(v.c)(t),Object(a.h)(m,{category:"Promise_For_Token_Request_Failed",err:n?n.toString():"",message:n?n.message:"",scope:e.scope,requestId:e.requestId})}))]):[3,2];case 2:return[4,f(e)];case 3:return n=o.sent(),D(t,n),[2,0==n.TokenResultCode?n.AccessToken:void 0]}}))}))}function D(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){var n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&E().put(e,t,n)}}function E(){return null==T&&(T=new c.Cache),T}function q(e){return e.redirect_uri=Object(A.a)()+y,e.authorization_uri=I,e.client_id=C,e}var x=n(6),U=n(432);var F=!1;function P(){var e;F||(e=Object(U.a)("/owa"),Object(x.b)({baseUrl:e}),F=!0)}var z={NoUserLogin:"AADSTS50058",InvalidResourceUrl:"AADSTS50001",NoPreAuth:"AADSTS65001",UserAborted:"AADSTS65004",NotConsent:"AADSTS70011"};function G(e,t,n,r,o){n?e.acquireTokenPopup(t,null,n,o):e.acquireToken(t,(function(n,c){n&&n.indexOf(z.NoPreAuth)>=0&&r?e.acquireTokenPopup(t,null,null,o):o(n,c)}))}var W=n(74),N=new W.c((function(){return n.e(470).then(n.bind(null,17515))})),L=new W.a(N,(function(e){return e.createAdalAuthenticationContext}));function B(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return e="https://login.microsoftonline.com/",[4,Object(u.a)({})];case 1:return 0===(null==(t=o.sent())?void 0:t.ResultCode)&&(null==t?void 0:t.AuthenticationUrl)&&(r=t.AuthenticationUrl.split("/"),n=r[0]+"//"+r[2]+"/"),[2,n||e]}}))}))}var Q=function(e,t,n,r,o){return function(c,i){c||!i?o(c,null):(e.getCachedUser(),G(e,t,n,r,o))}},M="adalIdTokenFrame";function $(e,t,n,r,o){e.config.displayCall=function(c){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(c),window.detectUserCachedCallback=Q(e,t,n,r,o),function(e,t){e._addAdalFrame(M).src="about:blank",e._loadFrame(t+"&prompt=none",M)}(e,c)},e.login()}var H=n(30);function J(e,t,n,r,c,i){var u,s;return Object(o.__awaiter)(this,void 0,void 0,(function(){var a,l,d,f,h;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,B()];case 1:return a=o.sent(),[4,L.importAndExecute(a,e,t)];case 2:return l=o.sent(),d=Object(H.a)(),f=null===(u=d.SessionSettings)||void 0===u?void 0:u.UserPrincipalName,h=null===(s=d.SessionSettings)||void 0===s?void 0:s.UserEmailAddress,l._user={profile:{upn:f||h}},l.getCachedUser()?G(l,n,r,c,i):$(l,n,r,c,i),[2]}}))}))}n.d(t,"getAccessTokenforResource",(function(){return r.b})),n.d(t,"getAccessTokenforResourceAsLazy",(function(){return r.c})),n.d(t,"getDelegationTokenForOwa",(function(){return R})),n.d(t,"bootstrap",(function(){return P})),n.d(t,"getAccessTokenOnBehalfOfResource",(function(){return J})),n.d(t,"AdalErrorCode",(function(){return z}))}}]);
//# sourceMappingURL=owa.3.js.map
self.scriptsLoaded['owa.3.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.3.js'] = (new Date()).getTime();