self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~Translation.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[779],{2245:function(e,t,n){"use strict";var a=n(3),r=n(361);t.a=Object(a.createStore)("TranslationStore",{sessionId:Object(r.a)(),localeOfSupportedLanguageMap:null,supportedLanguageMap:null,isUserLocaleSupported:!1,userLanguageName:null,userLanguageTag:null,settings:{translationMode:null,targetLanguage:null,excludedLanguages:[],initialized:!1}})()},9227:function(e,t,n){"use strict";var a;!function(e){e[e.Automatic=0]="Automatic",e[e.Suggestion=1]="Suggestion",e[e.Manual=2]="Manual",e[e.None=100]="None"}(a||(a={})),t.a=a},9535:function(e,t,n){"use strict";n.r(t);var a,r=n(0),s=n(2245),u=n(30),i=n(319),o="/ows/v1/OutlookCloudSettings/settings/account",g="translator_translation_mode",c="translator_target_language",l="translator_known_languages";function d(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return a||(a=Object(i.b)(o+"?settingname=\n            "+g+",\n            "+c+",\n            "+l,null,!1,null,!0).then((function(e){var t={translationMode:null,targetLanguage:null,excludedLanguages:null,initialized:!1};return e.forEach((function(e){switch(e.name){case g:t.translationMode=parseInt(e.value,10);break;case c:t.targetLanguage=e.value;break;case l:var n=JSON.parse(e.value);t.excludedLanguages=[],n.forEach((function(e){return t.excludedLanguages.push(e.languageTag)}))}})),t})).catch((function(e){throw a=null,e}))),[2,a]}))}))}function f(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,Object(i.c)(o,e,null,!0,{Accept:"application/json","x-overridetimestamp":!0})]}))}))}var p=n(3),L=Object(p.mutatorAction)("setTranslationSettings",(function(e){s.a.settings.translationMode=e.translationMode,s.a.settings.targetLanguage=e.targetLanguage,s.a.settings.excludedLanguages=e.excludedLanguages,s.a.settings.initialized=!0})),O=n(77),h=n(1299);function v(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return(t=Object(h.d)(h.a.Translation)).translationMode=Object(O.i)("tra-useOcsSettings")?e.translationMode+16:e.translationMode,t.targetLanguage=e.targetLanguage,t.excludedLanguages=e.excludedLanguages,[4,h.e.importAndExecute(h.a.Translation,t)];case 1:return n.sent(),[2]}}))}))}var b=n(336),x=n(266);function S(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,a,i,o,g,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(t=[],n=Object(u.a)().SessionSettings.UserEmailAddress,s.a.settings.translationMode!==e.translationMode&&(M(t,e.translationMode,n),Object(x.q)("InlineTranslationChangeTranslationMode",[],{cosmosOnlyData:e.translationMode.toString()})),a=!1,s.a.settings.targetLanguage!==e.targetLanguage&&(j(t,e.targetLanguage,n),e.excludedLanguages.indexOf(e.targetLanguage)<0&&(e.excludedLanguages.push(e.targetLanguage),a=!0),Object(x.q)("InlineTranslationChangeTargetLanguage",[],{cosmosOnlyData:e.targetLanguage?e.targetLanguage:"none"})),e.excludedLanguages.forEach((function(e){s.a.settings.excludedLanguages.includes(e)||(a=!0,Object(x.q)("InlineTranslationOptOutOfLanguage",[],{cosmosOnlyData:e}))})),s.a.settings.excludedLanguages.forEach((function(t){e.excludedLanguages.includes(t)||(a=!0,Object(x.q)("InlineTranslationRemoveOptOutOfLanguage",[],{cosmosOnlyData:t}))})),a&&_(t,e.excludedLanguages,n),!(t.length>0))return[3,7];i="SavingOcsSettings",r.label=1;case 1:return r.trys.push([1,5,,6]),Object(O.i)("tra-useOcsSettings")?[4,f(t)]:[3,3];case 2:if(!(o=r.sent())||!Object(b.a)(o.status))throw new Error("Failed to save settings in OCS");r.label=3;case 3:return i="SavingOoSettings",[4,v(e)];case 4:return r.sent(),[3,6];case 5:return g=r.sent(),c=g instanceof Error?g:new Error("Error while "+i),new x.b("InlineTranslationUpdateSettings").endWithError("ServerError",c),[2,!1];case 6:L(e),r.label=7;case 7:return[2,!0]}}))}))}function M(e,t,n){e.push({name:g,value:t,type:"Int",scope:n})}function j(e,t,n){var a=null==t?"":t;e.push({name:c,value:a,type:"String",scope:n})}function _(e,t,n){var a=[];t.forEach((function(e){a.push({languageTag:e}),e||Object(x.q)("InlineTranslationEmptyKnownLanguage",["Empty language"])})),0==a.length?Object(x.q)("InlineTranslationEmptyKnownLanguage",["Empty Known Languages list"]):e.push({name:l,value:JSON.stringify(a),type:"JSON",scope:n})}function m(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return s.a.settings.excludedLanguages&&e&&!s.a.settings.excludedLanguages.includes(e)?((t={translationMode:s.a.settings.translationMode,targetLanguage:s.a.settings.targetLanguage,excludedLanguages:Object(r.__spread)(s.a.settings.excludedLanguages),initialized:!0}).excludedLanguages.push(e),[4,S(t)]):[2];case 1:return n.sent(),[2]}}))}))}var w="-",T=4;function A(e){if(0===(e=e.toLowerCase()).lastIndexOf("zh-",0))switch(e){case"zh-cht":case"zh-hant":case"zh-hk":case"zh-tw":return"zh-cht";default:return"zh-chs"}var t=e.indexOf(w,1);if(-1===t)return e;var n=e.indexOf(w,t+w.length);return-1===n&&(n=e.length),n-t==w.length+T&&(t=n),e.substring(0,t)}function E(e){return!(!s.a.supportedLanguageMap||!e)&&s.a.supportedLanguageMap.has(e)}function y(e,t){void 0===t&&(t=null);var n=A(e);if(!E(n))return!1;if(null!=t){var a=A(t);return!!E(a)&&n!==a}return!0}var q=n(3959);var N="https://ogma.osi.office.net",G="/TradukoApi/api/v1.0/translateContentArray",I="/TradukoApi/api/v1.0/supportedLanguages",z="/TradukoApi/api/v1.0/detectLanguage",R="ows/api/v1/translation/translateText",U="ows/api/v1/translation/getSupportedLanguages";function H(e){return U+"?clientLocale="+e}var D=n(2),k=s.a.sessionId,W=Object(D.o)(),C=Object(D.p)();function J(e,t){return!!(t&&k&&W&&C)&&(e.setRequestHeader("Content-type","application/json"),e.setRequestHeader("Accept","application/json, text/plain, */*"),e.setRequestHeader("x-translator-sid",k),e.setRequestHeader("x-translator-cross-sid",k),e.setRequestHeader("x-translator-cid",t),e.setRequestHeader("x-translator-user-id",W),e.setRequestHeader("x-translator-client-version",C),e.setRequestHeader("x-translator-client-app","Outlook"),e.setRequestHeader("x-translator-client-type","Browser"),!0)}var P=n(96),F=n(9227),K=s.a.sessionId,X=Object(P.h)().SessionSettings.UserPuid,$=Object(D.p)();function B(e,t){if(e&&K&&X&&$)return{"x-translator-sid":K,"x-translator-cross-sid":K,"x-translator-cid":e,"x-translator-user-id":X,"x-translator-client-version":$,"x-translator-trigger-type":t||F.a.None,"x-translator-scenario-type":3}}var Q=3e4;function V(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,new Promise((function(n,a){Object(O.i)("rp-inlineTranslation-UseOWS")?function(e,t,n,a){Object(r.__awaiter)(this,void 0,void 0,(function(){var s,u,o,g,c,l,d,f;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(!(s=B(t)))return[3,5];u=A(e),o=!1,g=setTimeout((function(){o=!0,a("Request timed out")}),Q),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Object(i.b)(H(u),t,!1,s,!0)];case 2:return c=r.sent(),o||(clearTimeout(g),(l=Y(c))?n(l):a("OWS OGMA returned invalid response: "+c)),[3,4];case 3:return d=r.sent(),f=(null==d?void 0:d.message)?d.message:"",a("getSupportedLanguagesOWS failed:"+f),[3,4];case 4:return[3,6];case 5:a("getSupportedLanguagesOWS failed: headers were not set."),r.label=6;case 6:return[2]}}))}))}(e,t,n,a):function(e,t,n,a){var r=new XMLHttpRequest;r.timeout=Q,r.onload=function(){if(200===r.status)if(this.responseText){var e=Y(JSON.parse(this.responseText));e?n(e):a("OGMA returned invalid response: "+this.response)}else a("OGMA returned invalid response: "+this.response);else a("OGMA failed to retrieve supported languages: "+this.response)},r.onerror=function(){a("OGMA call failed: "+this.response)},r.ontimeout=function(){a("OGMA call timed out")};var s=A(e);r.open("GET",function(e){return""+N+I+"?clientLocale="+e}(s)),J(r,t)?r.send():a("getSupportedLanguagesOgma failed: headers were not set. ")}(e,t,n,a)}))]}))}))}function Y(e){try{var t=new Map;return e.forEach((function(e){t.set(e.LanguageTag,e)})),t}catch(e){return null}}function Z(e,t){if(e.length!=t.length)return!0;for(var n=0;n<e.length;n++)if(!t.includes(e[n]))return!0;return!1}function ee(e){if(!e||!e.excludedLanguages||e.excludedLanguages.length<=0)return!1;for(var t=!1,n=[],a=0;a<e.excludedLanguages.length;a++){var r=e.excludedLanguages[a];r&&s.a.supportedLanguageMap.has(r)?n.push(r):t=!0}return!!t&&(e.excludedLanguages=n,!0)}var te=Object(p.mutatorAction)("setSupportedLanguageMap",(function(e,t){var n=A(e),a=t.get(n);a?(s.a.localeOfSupportedLanguageMap=e,s.a.userLanguageName=a.LanguageName,s.a.userLanguageTag=n,s.a.supportedLanguageMap=t,s.a.isUserLocaleSupported=y(e)):s.a.isUserLocaleSupported=!1})),ne=n(361),ae=15e3,re=0,se=ae;function ue(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,a,i,o,g,c,l,p,b;return Object(r.__generator)(this,(function(S){switch(S.label){case 0:if(e=Object(u.a)().SessionSettings.UserCulture,t=Date.now(),Object(O.i)("rp-inlineTranslationAutomatic")||s.a.settings.translationMode!==q.a.Automatic||(s.a.settings.translationMode=q.a.Suggest),!Object(O.i)("rp-inlineTranslation-targetLanguage")&&s.a.settings.targetLanguage&&(s.a.settings.targetLanguage=""),e===s.a.localeOfSupportedLanguageMap&&s.a.settings.initialized||!(0===re||t>re+se))return[3,11];n=null,a=Object(ne.a)(),i=new x.b("InlineTranslationGetSupportedLanguages"),S.label=1;case 1:return S.trys.push([1,9,,10]),null!=s.a.supportedLanguageMap?[3,3]:[4,V(e,a)];case 2:n=S.sent(),te(e,n),E(s.a.settings.targetLanguage)||(s.a.settings.targetLanguage=""),S.label=3;case 3:return s.a.settings.initialized?[3,8]:[4,h.f.import()];case 4:return[4,S.sent()(h.a.Translation)];case 5:return o=S.sent(),g=function(e){if(e.translationMode>q.a.Suggest)return e.translationMode=e.translationMode-16,(e.translationMode<q.a.SuggestAutomatic||e.translationMode>q.a.Suggest)&&(e.translationMode=q.a.SuggestAutomatic),!1;return!0}(o),c={translationMode:o.translationMode,targetLanguage:null!=o.targetLanguage?o.targetLanguage:"",excludedLanguages:null==o.excludedLanguages?[]:Object(r.__spread)(o.excludedLanguages),initialized:!1},Object(O.i)("tra-useOcsSettings")?[4,d()]:[3,7];case 6:l=S.sent(),function(e,t,n){var a=!1,r=!1,i=[],o=Object(u.a)().SessionSettings.UserEmailAddress;ee(e)&&(a=!0),ee(t)&&(r=!0),null==t.translationMode||n&&t.translationMode!==e.translationMode?M(i,e.translationMode,o):t.translationMode!==e.translationMode&&(e.translationMode=t.translationMode,a=!0),e.targetLanguage||(e.targetLanguage=s.a.userLanguageTag,a=!0),!t.targetLanguage||n&&t.targetLanguage!==e.targetLanguage?j(i,e.targetLanguage,o):t.targetLanguage!==e.targetLanguage&&(e.targetLanguage=t.targetLanguage,a=!0),null==t.excludedLanguages||n&&Z(e.excludedLanguages,t.excludedLanguages)?(e.targetLanguage&&e.excludedLanguages.indexOf(e.targetLanguage)<0&&(e.excludedLanguages.push(e.targetLanguage),a=!0),_(i,e.excludedLanguages,o)):(r&&_(i,e.excludedLanguages,o),Z(e.excludedLanguages,t.excludedLanguages)&&(e.excludedLanguages=t.excludedLanguages,a=!0)),i.length>0&&f(i),(a||n)&&v(e)}(c,l,g),S.label=7;case 7:L(c),S.label=8;case 8:return re=0,se=ae,i.end(),[3,10];case 9:throw p=S.sent(),b=new Error("[InlineTranslation] Failed to initialize translation. Error:"+p+" | cid:"+a),re=t,se*=2,i.endWithError("ServerError",b),p;case 10:return[2,!0];case 11:return[2,!1]}}))}))}function ie(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){switch(e.label){case 0:return[4,ue()];case 1:return e.sent(),[2,s.a.supportedLanguageMap]}}))}))}function oe(){return s.a.localeOfSupportedLanguageMap}function ge(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,new Promise((function(n,a){var r=new XMLHttpRequest;r.onload=function(){if(200===r.status){var e=JSON.parse(this.responseText);e?n(e):a("OGMA returned invalid response: "+this.response)}else a("OGMA failed to detect email language: "+this.response)},r.onerror=function(){a("OGMA call failed: "+this.response)},r.open("POST",""+N+z),J(r,t)?r.send(JSON.stringify(e)):a("getOgmaDetectedLanguage failed: headers were not set. ")}))]}))}))}var ce=1e4;function le(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,a,s,u,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:t=Object(ne.a)(),n=null,a=new x.b("InlineTranslationGetDetectedLanguage"),r.label=1;case 1:return r.trys.push([1,3,,4]),(s=e.join(" ")).length>ce&&(s=s.substring(0,ce)),[4,ge(s,t)];case 2:return n=r.sent(),a.end(),[3,4];case 3:return u=r.sent(),i=new Error("[InlineTranslation] getOgmaDetectedLanguage failed. Error:"+u+" | cid:"+t),a.endWithError("ServerError",i),[3,4];case 4:return[2,n]}}))}))}function de(e){return s.a.supportedLanguageMap.has(e)?s.a.supportedLanguageMap.get(e).LanguageName:null}function fe(){return s.a.userLanguageName}function pe(){return s.a.userLanguageTag}function Le(){return s.a.settings.targetLanguage?de(s.a.settings.targetLanguage):fe()}function Oe(){return s.a.settings.targetLanguage?s.a.settings.targetLanguage:s.a.userLanguageTag}function he(){return s.a.settings}function ve(){return s.a.isUserLocaleSupported}var be=3e4;function xe(e,t,n,a){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(s){return[2,new Promise((function(s,u){Object(O.i)("rp-inlineTranslation-UseOWS")?function(e,t,n,a,s,u){Object(r.__awaiter)(this,void 0,void 0,(function(){var o,g,c,l,d;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(!(o=B(n,a)))return[3,5];g=!1,c=setTimeout((function(){g=!0,u("Request timed out")}),be),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Object(i.d)((f=t,R+"?toLang="+f),e,n,!1,o,!0)];case 2:return l=r.sent(),g||(clearTimeout(c),null!=l?s(Se(l)):u("OGMA returned invalid response: "+l)),[3,4];case 3:return d=r.sent(),u("translateTextOWS failed:"+d.message),[3,4];case 4:return[3,6];case 5:u("translateTextOWS failed: headers were not set."),r.label=6;case 6:return[2]}var f}))}))}(e,t,n,a,s,u):function(e,t,n,a,r){var s=new XMLHttpRequest;s.timeout=be,s.onload=function(){if(200===s.status){var e=JSON.parse(this.responseText);null!=e?a(Se(e)):r("OGMA returned invalid response: "+this.response)}else r("OGMA failed to translate messaage: "+this.response)},s.onerror=function(){r("OGMA call failed: "+this.response)},s.ontimeout=function(){r("OGMA call timed out")},s.open("POST",function(e){return""+N+G+"?fromLang=&toLang="+e}(t)),J(s,n)?s.send(function(e){var t=[];return e.forEach((function(e){var n={Data:e,DataType:"html"};t.push(n)})),JSON.stringify(t)}(e)):r("getSupportedLanguagesOgma failed: headers were not set. ")}(e,t,n,s,u)}))]}))}))}function Se(e){var t=[];return e.forEach((function(e){t.push(e.TranslatedText)})),t}function Me(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,S({translationMode:e,targetLanguage:s.a.settings.targetLanguage,excludedLanguages:Object(r.__spread)(s.a.settings.excludedLanguages),initialized:!0})];case 1:return t.sent(),[2]}}))}))}n.d(t,"addExcludedLanguage",(function(){return m})),n.d(t,"checkCanTranslate",(function(){return y})),n.d(t,"initSupportedLanguages",(function(){return ue})),n.d(t,"initAndGetSupportedLanguageMap",(function(){return ie})),n.d(t,"getLocaleOfSupportedLanguageMap",(function(){return oe})),n.d(t,"getOgmaSupportedLanguageTag",(function(){return A})),n.d(t,"getDetectedLanguage",(function(){return le})),n.d(t,"getLanguageNameFromTag",(function(){return de})),n.d(t,"getUserLanguageName",(function(){return fe})),n.d(t,"getUserLanguageTag",(function(){return pe})),n.d(t,"getTargetLanguageName",(function(){return Le})),n.d(t,"getTargetLanguageTag",(function(){return Oe})),n.d(t,"getTranslationSettings",(function(){return he})),n.d(t,"getIsUserLocaleSupported",(function(){return ve})),n.d(t,"translateText",(function(){return xe})),n.d(t,"updateTranslationMode",(function(){return Me})),n.d(t,"updateTranslationSettings",(function(){return S}))}}]);
//# sourceMappingURL=owa.MailBoot~Translation.js.map
self.scriptsLoaded['owa.MailBoot~Translation.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~Translation.js'] = (new Date()).getTime();