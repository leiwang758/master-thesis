self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~AttachmentModelStore.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[482],{1314:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.Base64InlineImage=0]="Base64InlineImage",e[e.Cloud=1]="Cloud",e[e.Local=2]="Local",e[e.MailItem=3]="MailItem",e[e.Uri=4]="Uri",e[e.AttachmentItem=5]="AttachmentItem",e[e.CloudSuggestion=6]="CloudSuggestion",e[e.AttachmentItemSuggestion=7]="AttachmentItemSuggestion",e[e.Inline=8]="Inline",e[e.Smime=9]="Smime",e[e.FilesHub=10]="FilesHub",e[e.GroupFilesHub=11]="GroupFilesHub",e[e.MailSearchFileSuggestion=12]="MailSearchFileSuggestion",e[e.Unknown=13]="Unknown",e[e.ContextualSuggestion=14]="ContextualSuggestion",e[e.ConsumerGroupFilesHub=15]="ConsumerGroupFilesHub",e[e.SmartDoc=16]="SmartDoc",e[e.ExpirableBase64InlineImage=17]="ExpirableBase64InlineImage"}(r||(r={}))},1345:function(e,t,n){"use strict";var r=n(1307),i=n(1584),a=n(11);function o(e){var t;return e>=1073741824?(e/=1073741824,t=Object(a.b)(i.b)):e>=1048576?(e/=1048576,t=Object(a.b)(i.d)):e>=1024?(e/=1024,t=Object(a.b)(i.c)):t=Object(a.b)(i.a),Object(a.c)(t,Math.round(e))}var c,u=n(1408),s=n(77),d=[".pdf",".doc",".docx",".odt",".rtf",".ppt",".pptx",".pptm",".potx",".potm",".pot",".ppxx",".pps",".odp"];function l(e){if(!Object(s.i)("doc-attachment-documentThumbnail"))return!1;var t=Object(r.a)(e);return!!t&&d.indexOf(t.toLowerCase())>=0}function f(e){switch(e){case".doc":case".docm":case".docx":case".dot":case".dotm":case".dotx":case".odt":case".rtf":return c.Word;case".csv":case".ods":case".xls":case".xlsb":case".xlsm":case".xlsx":return c.Excel;case".odp":case".pot":case".potm":case".potx":case".pps":case".ppsm":case".ppsx":case".ppt":case".pptm":case".pptx":return c.PowerPoint;default:return null}}!function(e){e[e.Word=0]="Word",e[e.Excel=1]="Excel",e[e.PowerPoint=2]="PowerPoint"}(c||(c={}));var b=n(1362);n.d(t,"b",(function(){return r.a})),n.d(t,"c",(function(){return r.b})),n.d(t,"d",(function(){return r.c})),n.d(t,"i",(function(){return o})),n.d(t,"g",(function(){return u.a})),n.d(t,"h",(function(){return l})),n.d(t,"f",(function(){return f})),n.d(t,"e",(function(){return b.b})),n.d(t,"a",(function(){return c}))},1352:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(1674);function i(e){return Object(r.a)().attachments.get(e.Id)}},1362:function(e,t,n){"use strict";function r(e){return t=e||"",(n=a.exec(t))&&n.length>1&&i[n[1].toLowerCase()];var t,n}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var i={"image/bmp":".bmp","image/x-ms-bmp":".bmp","image/gif":".gif","image/jpeg":".jpeg","image/png":".png","image/vnd.adobe.photoshop":".psd","image/tiff":".tiff"},a=/^\s*([^;\s]*)(?:;|\s|$)/;function o(e){var t="";return Object.entries(i).forEach((function(n){n[1]===e&&(t=n[0])})),t}},1408:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return s}));var r=n(1307),i=n(1362),a=n(67),o=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd"],c=[".tiff",".tif"];function u(e,t,n){return void 0===n&&(n=!0),s(Object(r.a)(e)||Object(i.a)(t),n)}function s(e,t){return void 0===t&&(t=!0),!!e&&(o.indexOf(e.toLowerCase())>=0||t&&c.indexOf(e.toLowerCase())>=0&&(Object(a.e)()||Object(a.d)()||Object(a.h)()||Object(a.g)()&&!Object(a.l)()))}},1434:function(e,t,n){"use strict";var r=n(1314),i=n(1345);function a(e){return e.map((function(e){return{fileType:r.a.Uri,name:e.name,type:Object(i.b)(e.url)||"",size:0,uri:e.url}}))}var o=n(56);function c(e,t,n){if(e.length!=t.length)return o.d("The sizes of subjects and latestItemIds are different"),null;for(var i=[],a=0;a<e.length;a++){var c={fileType:r.a.MailItem,name:e[a],size:(null==n?void 0:n[a])||0,itemId:t[a]};i.push(c)}return i}function u(e,t,n){var i=[],a={fileType:r.a.MailItem,name:e,size:n||0,mimeContent:t};return i.push(a),i}function s(e){if(!e)return null;for(var t=[],n=0;n<e.length;n++){var i=e[n],a={fileType:r.a.Local,name:i.name,size:i.size,type:i.type,fileObject:i};t.push(a)}return t}function d(e){if(!e)return null;for(var t=[],n=0;n<e.length;n++){var r=e[n],i={fileType:r.fileType,name:r.name,size:r.size,type:r.type,dataUri:r.dataUri};t.push(i)}return t}function l(e){var t,n;return null===e?null:{fileType:r.a.Cloud,name:e.Name,size:e.Size,providerId:e.AttachmentProviderId,providerType:e.ProviderType,location:e.Location,providerEndpointUrl:e.ProviderEndpointUrl,isFolder:1===e.Type,fileId:e.Id,fileParentId:e.ParentId,thumbnailUrl:(null===(t=e.Thumbnail)||void 0===t?void 0:t.Url)||"",previewUrl:(null===(n=e.Preview)||void 0===n?void 0:n.Url)||"",type:e.MimeType}}function f(e){return null===e?null:{attachmentItemId:e.Id,name:e.Name,size:e.Size,fileType:r.a.AttachmentItem,type:"ItemIdAttachment:#Exchange"}}var b={BOX:"Box",DROPBOX:"Dropbox",FACEBOOK:"Facebook",GDRIVE:"GDrive",MAILBOX:"Mailbox",ONE_DRIVE_CONSUMER:"OneDriveConsumer",ONE_DRIVE_PRO:"OneDrivePro",RECENT_ATTACHMENTS:"RecentAttachments",WOPI:"Wopi",WOPI_BOX:"WopiBox",WOPI_EGNYTE:"WopiEgnyte"};function v(e){switch(e?e.toLowerCase():null){case b.ONE_DRIVE_PRO.toLowerCase():return 0;case b.GDRIVE.toLowerCase():return 5;case b.ONE_DRIVE_CONSUMER.toLowerCase():return 1;case b.DROPBOX.toLowerCase():return 2;case b.BOX.toLowerCase():return 3;case b.WOPI_BOX.toLowerCase():return 7;case b.WOPI_EGNYTE.toLowerCase():return 8;case b.MAILBOX.toLowerCase():return 4;case b.FACEBOOK.toLowerCase():return 6;default:return null}}n.d(t,"i",(function(){return a})),n.d(t,"h",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return s})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return r.a}))},1584:function(e){e.exports=JSON.parse('{"b":"Psb","d":"Qsb","c":"Rsb","a":"Ssb"}')},1767:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(290),i=n(389);function a(e){if("ArchiveMailbox"==e.type)return Object(r.a)();var t=e.userIdentity&&Object(i.r)(e.userIdentity),n="GroupMailbox"===e.type;return t&&!n?Object(r.b)(e.mailboxSmtpAddress)+e.userIdentity:"UserMailbox"===e.type?Object(r.a)():e.mailboxSmtpAddress}},1770:function(e,t,n){"use strict";var r=n(389),i=n(0),a={};function o(e){return a[e]}function c(e,t){var n=a[e];a[e]=Object(i.__assign)(Object(i.__assign)({},n),t)}var u=n(96),s=n(29);var d=n(266),l=n(56),f=n(677),b=n(1333),v=n(1331);function m(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(i.__generator)(this,(function(r){switch(r.label){case 0:return(t={}).headers=new Headers,[4,Object(b.a)(e)];case 1:return n=r.sent(),Object(v.b)(t.headers,n),[2,t]}}))}))}var p=Object(f.b)({timeBetweenRetryInMS:function(){return 3e4}});function O(e,t){t=t<1?1:t,setInterval((function(){!function(e){Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n,a,u,f,b,v=this;return Object(i.__generator)(this,(function(O){switch(O.label){case 0:if(t=function(){return Object(i.__awaiter)(v,void 0,void 0,(function(){var t,n;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t={},Object(r.r)(e.userIdentity)?[4,m(e.userIdentity)]:[3,2];case 1:t=i.sent(),i.label=2;case 2:return[2,(a=t,Object(s.a)("GetAttachmentDownloadToken",{},a))];case 3:throw n=i.sent(),l.g.warn("Unable to get the download token "+n),n.networkError=!0,n;case 4:return[2]}var a}))}))},null==(n=o(e.userIdentity))?void 0:n.isRefreshingDownloadToken)return[3,4];c(e.userIdentity,{isRefreshingDownloadToken:!0}),a=0,u=p((function(){return Object(i.__awaiter)(v,void 0,void 0,(function(){var n;return Object(i.__generator)(this,(function(r){switch(r.label){case 0:return a++,[4,t()];case 1:return n=r.sent(),l.g.info("update new token"),c(e.userIdentity,{downloadToken:n,isRefreshingDownloadToken:!1}),[2]}}))}))})).retriableFunc,f=new d.c("AttachmentRefreshDownloadToken"),O.label=1;case 1:return O.trys.push([1,3,,4]),[4,u()];case 2:return O.sent(),f.addCustomData([a]),f.end(),[3,4];case 3:return b=O.sent(),l.g.warn("Retry to refresh token failed: "+b),f.addCustomData([a]),f.endWithError("ServerError",b),c(e.userIdentity,{isRefreshingDownloadToken:!1}),[3,4];case 4:return[2]}}))}))}(e)}),6e4*t)}var h=n(267);function I(e){var t=Object(r.j)(null==e?void 0:e.userIdentity),n=o(null==e?void 0:e.userIdentity);if((null==n?void 0:n.downloadToken)&&(null==n?void 0:n.downloadUrlBase))return n;switch(t){case null:case"Outlook":!function(e){var t=Object(r.r)(e.userIdentity)?Object(u.i)(e.userIdentity):Object(u.h)(),n=null==t?void 0:t.ApplicationSettings;if(n){var i=n.DownloadUrlBase;c(e.userIdentity,{downloadUrlBase:i,downloadToken:n.FirstDownloadToken}),i&&O(e,n.DownloadTokenRefreshMinutes)}}(e);break;case"Google":case"ICloud":break;default:Object(h.a)(t)}var i=o(e.userIdentity);return i||(Object(d.q)("FilesUrlDataNotFound",{accountProviderType:t}),l.g.warn("Unable to get the url data")),i}function j(e){if(!e)return null;var t=I(e);return null==t?void 0:t.downloadToken}n.d(t,"b",(function(){return I})),n.d(t,"a",(function(){return j}))},1958:function(e,t,n){"use strict";var r=n(1986);n.d(t,"a",(function(){return r.a})),n.d(t,"b",(function(){return r.b}));var i=n(1770);n.d(t,"c",(function(){return i.a}));var a=n(1767);n.d(t,"d",(function(){return a.a}))},1986:function(e,t,n){"use strict";var r=n(267),i=n(11),a=n(42),o="/owa/",c="service.svc/s/GetFileAttachment?id={0}",u="service.svc/s/GetReferenceAttachment?attachmentId={0}&location={1}",s="service.svc/s/GetAttachmentThumbnail?id={0}&thumbnailType=2",d="service.svc/s/GetReferenceAttachment?attachmentId={0}&location={1}&isImagePreview=True",l="service.svc/s/GetAttachmentThumbnail?id={0}",f="pdfprint.aspx?id={0}",b="pdfprint.aspx?id={0}&location={1}",v=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd",".tiff",".tif"];var m=n(318),p=n(55),O=n(2),h=n(27),I=n(1770),j=n(1767);function w(e,t,n,r,c){if(void 0===r&&(r=!1),void 0===c&&(c=null),!e||!e.Id||!e.mailboxInfo)return null;var u=Object(I.b)(e.mailboxInfo),s=null==u?void 0:u.downloadUrlBase,d=Object(j.a)(e.mailboxInfo);if(c=c||Object(i.c)(t,encodeURIComponent(e.Id)),!s||r&&"Firefox"===Object(p.a)().browser){var l=o+c+"&X-OWA-CANARY="+Object(a.a)();return Object(h.a)(l)}var f="{0}{1}/{2}";Object(m.a)()&&(f+="&isc=1");var b=Object(i.c)(f,s,d,c);return n&&(b+="&token="+(null==u?void 0:u.downloadToken),b+="&X-OWA-CANARY="+Object(a.a)()),Object(p.i)()||(b+="&owa="+window.location.hostname,b+="&scriptVer="+Object(O.p)()||!1),b}function g(e,t,n,c,s,l,f,m,p){var O;switch(void 0===s&&(s=0),void 0===l&&(l=0),void 0===f&&(f=!0),void 0===m&&(m=null),void 0===p&&(p=null),n){case 0:O=u;break;case 3:O=b;break;case 1:if(!function(e){if(!e)return!1;var t=null,n=e.lastIndexOf(".");return n>0&&(t=e.substr(n).toLowerCase()),!!t&&v.indexOf(t.toLowerCase())>=0}(m))return null;O=d;break;default:Object(r.a)(n)}var I=c?l:s;!I&&s&&(I=s);var j=Object(i.c)("{0}&permissionLevel={1}",Object(i.c)(O,encodeURIComponent(e.Id),encodeURIComponent(t)),I),g=w(e,O,!0,3===n,j);if(g)return g;var y=Object(i.c)("{0}{1}{2}",o,p,j);f&&(y=y+"&X-OWA-CANARY="+Object(a.a)());return Object(h.a)(y)}function y(e,t,n,a){var o;switch(void 0===n&&(n=!1),void 0===a&&(a=!0),t){case 0:o=c;break;case 1:o=s;break;case 2:o=l;break;case 3:o=f;break;default:return Object(r.a)(t)}if(!Object(i.f)(o)){var u=w(e,o,a,3===t);return Object(i.c)("{0}{1}{2}",u,n?"&isDownload=true":"","&animation=true")}return null}n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return y}))},2181:function(e,t,n){"use strict";var r=n(267),i=n(1958),a=n(42),o=n(2613);function c(e,t,n,a,c){var u;void 0===c&&(c=!0);var s=t,d=s.Name,l=s.OriginalPermissionType,f=s.PermissionType,b=Object(o.a)(t),v="GroupMailbox"===(null===(u=null==e?void 0:e.mailboxInfo)||void 0===u?void 0:u.type)?e.mailboxInfo.mailboxSmtpAddress+"/":null;switch(n){case 0:case 3:return i.b(e,b,n,a,f,l,c,d,v);case 1:return t.AttachmentPreviewUrl?t.AttachmentPreviewUrl:i.b(e,b,1,a,f,l,c,d,v);case 2:return t.AttachmentThumbnailUrl;default:return Object(r.a)(n)}}function u(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),i.a(e,t,n,r)}function s(e,t,n,r,o){void 0===o&&(o=!1);var s=n?c(e,t,1,r,!1):u(e,1,o,!1);if(n)return{url:s,init:{credentials:"include"}};var d=Object(i.c)(e.mailboxInfo),l=new Headers;return l.set("X-Token",d),l.set("X-OWA-CANARY",Object(a.a)()),{url:s,init:{headers:l}}}function d(e,t,n,r,i,a){return void 0===a&&(a=!1),r?c(e,t,n,i):u(e,n,a)}n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return s}))},2613:function(e,t,n){"use strict";function r(e){var t=null;return(t=e.AttachLongPathName)||(t=e.WebUrl),t}n.d(t,"a",(function(){return r}))},4173:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(3),a=Object(i.action)("checkPendingAttachmentOperation",(function(e,t,n,r,i){return{attachmentId:e,itemId:t,operationId:n,operationType:r,completeHandler:i}}));function o(e){return Object(r.__assign)({__type:"CheckPendingAttachmentOperationRequest:#Exchange"},e)}var c=n(29);function u(e,t,n,r,i){var a,u,s=function(e,t,n,r){return o({ewsAttachmentId:e,itemId:t,operationId:n,operationType:r})}(e,t,n,r);return u=i,void 0===(a=s)||a.__type||(a=o(a)),Object(c.a)("CheckPendingAttachmentOperation",a,u)}var s=n(56),d=n(443),l=(Object(i.orchestrator)(a,(function(e){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var t,n,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=e.itemId?e.itemId.mailboxInfo:e.attachmentId.mailboxInfo,[4,u(e.attachmentId?e.attachmentId.Id:null,e.itemId?e.itemId.Id:null,e.operationId,e.operationType,Object(d.a)(t))];case 1:return n=r.sent(),e.completeHandler(n),[3,3];case 2:return i=r.sent(),s.g.warn("checkPendingAttachmentOperationAction is failing with error: "+i),[3,3];case 3:return[2]}}))}))})),n(2227)),f=n(1352),b=n(1887),v=n(6938);Object(i.orchestrator)(b.n,(function(e){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return"object"!=typeof e.id?[3,2]:(t=Object(f.a)(e.id))?(n=t.model,[4,Object(v.a)([e.id],n.PermissionType)]):[3,2];case 1:r.sent(),Object(l.a)(t.id),r.label=2;case 2:return[2]}}))}))}));var m=n(3724),p=n(281),O=Object(p.action)("setPreviewImageUrl")((function(e,t){Object(f.a)(e).previewImage.url=t})),h=n(5232),I=n(5687),j=n(1905),w=n(4410),g=n(1761),y=n(2181);function A(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(w.a)(e)];case 1:if(null==(t=n.sent()))throw new Error("URL not available");return"2",[2,t+"2"]}}))}))}var _=Object(p.action)("refreshPreviewImageUrl")((function(e,t,n){return void 0===n&&(n=!1),Object(r.__awaiter)(this,void 0,void 0,(function(){var i,a,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return i=Object(f.a)(e),Object(g.b)(i.model)&&i.model.ProviderType===j.e?[4,A(i.model)]:[3,2];case 1:return a=r.sent(),O(e,a),[3,3];case 2:Object(g.b)(i.model)&&i.model.ProviderType!==j.h&&i.model.ProviderType!==j.i||(o=Object(y.a)(e,i.model,1,1===i.type,t,n),O(e,o)),r.label=3;case 3:return[2]}}))}))})),x=n(4411),T=n(5412),C=Object(p.action)("setAttachmentInfo")((function(e,t){Object(f.a)(e).info=t}));n.d(t,"addAndInitializeAttachments",(function(){return m.a})),n.d(t,"setPreviewImageUrl",(function(){return O})),n.d(t,"refreshDownloadUrl",(function(){return h.a})),n.d(t,"refreshThumbnailImageUrl",(function(){return I.a})),n.d(t,"refreshPreviewImageUrl",(function(){return _})),n.d(t,"getAttachment",(function(){return f.a})),n.d(t,"checkPendingAttachmentOperation",(function(){return a})),n.d(t,"shouldShowImageView",(function(){return x.a})),n.d(t,"createAttachmentInfo",(function(){return T.a})),n.d(t,"setAttachmentInfo",(function(){return C}))}}]);
//# sourceMappingURL=owa.MailBoot~AttachmentModelStore.js.map
self.scriptsLoaded['owa.MailBoot~AttachmentModelStore.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~AttachmentModelStore.js'] = (new Date()).getTime();