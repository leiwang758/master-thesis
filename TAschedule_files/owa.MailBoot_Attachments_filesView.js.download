self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~Attachments~filesView.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[216],{11159:function(t,e,n){"use strict";var r=n(0),a=n(5606),i=n(4758),o=n(1485),c=n(56),s=n(281),u=Object(s.action)("replaceAttachmentInWell")((function(t,e,n,r){var s=t.docViewAttachments.indexOf(e);s>-1?(Object(i.a)(t,e),t.docViewAttachments.splice(s,0,n)):(s=t.imageViewAttachments.indexOf(e))>-1?(Object(i.a)(t,e),t.imageViewAttachments.splice(s,0,n)):c.d("Can't find the oldAttachment when invoking replaceAttachmentInWell"),n.isCloudy||Object(a.a)(t,r,n.attachmentId),Object(o.o)(n.attachmentId)})),l=n(1752);function d(t,e,n,a,i){var o=Object(l.h)(Object(r.__assign)(Object(r.__assign)({},n.AttachmentId),{mailboxInfo:e.attachmentId.mailboxInfo}),n,a,i,!0,!1,null,null,!1);u(t,e,o,n.Size)}n.d(e,"a",(function(){return d}))},13563:function(t){t.exports=JSON.parse('{"a":"jib"}')},13566:function(t){t.exports=JSON.parse('{"a":"Yib"}')},13567:function(t){t.exports=JSON.parse('{"b":"Pib","d":"Qib","e":"Rib","c":"Sib","f":"Tib","a":"Uib"}')},1417:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"g",(function(){return i})),n.d(e,"d",(function(){return o})),n.d(e,"c",(function(){return c})),n.d(e,"f",(function(){return s})),n.d(e,"b",(function(){return u})),n.d(e,"e",(function(){return l}));var r=n(3),a=Object(r.action)("ADD_SHARING_LINK",(function(t,e,n,r,a,i,o,c){return{linkId:t,url:e,sharingLinkIds:n,response:r,source:a,providerType:i,unwrappedUrl:o,creationDateTime:c}})),i=Object(r.action)("SHARING_LINK_REMOVED",(function(t,e){return{linkId:t,sharingLinkIds:e}})),o=Object(r.action)("DELETE_LINK",(function(t,e){return{linkId:t,targetWindow:e}})),c=Object(r.action)("CREATE_ATTACHMENT_FROM_LINK",(function(t,e,n,r){return{linkId:t,providerId:e,isTryAgain:n,targetWindow:r}})),s=Object(r.action)("ON_LINK_HAS_CHANGED",(function(t,e,n,r){return{linkId:t,recipientInfos:e,composeId:n,isCalendar:r}})),u=Object(r.action)("ADD_SHARING_LINK_TO_CONTAINER",(function(t,e){return{linkId:t,linkIdContainer:e}})),l=Object(r.action)("ON_FLUID_LINK_CREATED",(function(t,e,n,r){return{linkId:t,containerId:e,owaSource:n,url:r}}))},1449:function(t,e,n){"use strict";n.d(e,"e",(function(){return a})),n.d(e,"f",(function(){return i})),n.d(e,"g",(function(){return o})),n.d(e,"c",(function(){return c})),n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"d",(function(){return l}));var r=n(3),a=Object(r.action)("UPDATE_SHARING_LINK_FROM_SHARING_DIALOG",(function(t,e){return{linkId:t,sharingDialogResponse:e}})),i=Object(r.action)("UPDATE_SHAREPOINT_LINK_PERMISSION",(function(t,e){return{linkId:t,newPermission:e}})),o=Object(r.action)("UPDATE_SHAREPOINT_LINK_URL",(function(t,e,n,r){return{linkId:t,newLinkUrl:e,oldLinkUrl:n,expirationDate:r}})),c=Object(r.action)("SET_REFRESH_STATUS_FOR_LINK",(function(t,e){return{linkId:t,actionStatus:e}})),s=Object(r.action)("CREATE_OR_UPDATE_SHARING_LINK",(function(t,e,n,r,a,i,o,c,s){return{linkId:t,sharingUrl:e,currentUrl:n,canonicalUrl:r,newPermissionLevel:a,providerType:i,composeId:o,recipientInfos:c,isCalendar:s}})),u=Object(r.action)("ADD_SHARING_LINK_INFO",(function(t,e){return{linkId:t,linkModel:e}})),l=Object(r.action)("TOKEN_UNAVAILABLE",(function(t){return{linkId:t}}))},1509:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(1957),a=n(1562);function i(t){var e=Object(r.a)(),n=Object(a.b)(t);return e.sharingLinks.get(n)}},1529:function(t,e,n){"use strict";var r,a=n(74),i=n(1417),o=n(1449),c=n(2002);!function(t){t.PasteHtml="PasteHtml",t.InsertLinkFromToolbar="InsertLinkFromToolbar",t.InsertLinkFromAttachMenu="InsertLinkFromAttachMenu",t.AutoLink="AutoLink",t.ReplyOrForward="ReplyOrForward",t.LinkContextMenu="LinkContextMenu",t.Undo="Undo",t.EditorLoadedOrDraftOrReply="EditorLoadedOrDraftOrReply",t.RestoreCursor="RestoreCursor",t.ShareLinkCompose="ShareLinkCompose",t.NewFluidFile="NewFluidFile",t.Unknown="Unknown"}(r||(r={}));var s=n(1856),u=n(1562),l=n(1509),d=[r.PasteHtml,r.InsertLinkFromToolbar,r.AutoLink,r.ShareLinkCompose,r.InsertLinkFromAttachMenu];function m(t){var e=Object(l.a)(t);return e&&-1!==d.indexOf(e.source)}var h=n(1885);function f(t){var e=Object(l.a)(t);return e?{id:e.linkId,name:e.fileName,supportsDownsell:!1,currentPermissionLevel:e.permissionLevel,sharingInfo:e.sharingInfo,sharingTipsIgnored:e.sharingTipsIgnored,sharingRecipientsInfo:e.sharingRecipientsInfo,typeOfLink:m(t)?"newLink":"oldLink"}:null}var b=n(1957);function p(){return Object(b.a)().sharingLinks.size}var I=n(2003);n.d(e,"q",(function(){return g})),n.d(e,"u",(function(){return O})),n.d(e,"y",(function(){return A})),n.d(e,"w",(function(){return j})),n.d(e,"v",(function(){return C})),n.d(e,"t",(function(){return _})),n.d(e,"x",(function(){return y})),n.d(e,"s",(function(){return w})),n.d(e,"r",(function(){return S})),n.d(e,"B",(function(){return v})),n.d(e,"c",(function(){return i.a})),n.d(e,"d",(function(){return i.b})),n.d(e,"e",(function(){return i.c})),n.d(e,"g",(function(){return i.d})),n.d(e,"E",(function(){return i.g})),n.d(e,"z",(function(){return i.e})),n.d(e,"A",(function(){return i.f})),n.d(e,"F",(function(){return o.e})),n.d(e,"G",(function(){return o.f})),n.d(e,"H",(function(){return o.g})),n.d(e,"D",(function(){return o.c})),n.d(e,"f",(function(){return o.b})),n.d(e,"C",(function(){return c.b})),n.d(e,"a",(function(){return r})),n.d(e,"n",(function(){return s.a})),n.d(e,"h",(function(){return u.a})),n.d(e,"i",(function(){return u.b})),n.d(e,"p",(function(){return u.c})),n.d(e,"o",(function(){return m})),n.d(e,"b",(function(){return h.a})),n.d(e,"l",(function(){return l.a})),n.d(e,"k",(function(){return f})),n.d(e,"j",(function(){return p})),n.d(e,"m",(function(){return I.a}));var v=new a.c((function(){return Promise.all([n.e(3),n.e(34),n.e(71),n.e(626)]).then(n.bind(null,17163))})),g=new a.b(v,(function(t){return t.addRecipientsIntoLink})),O=new a.b(v,(function(t){return t.removeRecipientsFromLink})),A=new a.b(v,(function(t){return t.updateRecipientPermissionInfos})),j=new a.b(v,(function(t){return t.setGetPermissionInfoFailure})),C=new a.b(v,(function(t){return t.resetSharingRecipientsInfo})),_=new a.b(v,(function(t){return t.ignoreSharingTip})),y=new a.b(v,(function(t){return t.setLinkActionStatus})),w=new a.b(v,(function(t){return t.getSharingTipRecipientInfo})),S=new a.b(v,(function(t){return t.createCloudFileFromSharingLink}))},1562:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return c}));var r=n(77),a="_ODSPPSL";function i(t){return Object(r.i)("doc-link-savePermission")&&t&&-1!==t.indexOf(a)?t.substring(0,t.length-a.length):t}function o(t){return!!Object(r.i)("doc-link-savePermission")&&t.lastIndexOf(a)===t.length-a.length}function c(t,e){return!Object(r.i)("doc-link-savePermission")||2!==e&&1!==e?t:t+a}},1629:function(t,e,n){"use strict";var r=n(0),a=n(2228),i=n(281),o=Object(i.action)("addInfoBarMessage")((function(t,e,n){if(t){-1==t.infoBarIds.indexOf(e)?t.infoBarIds.push(e):t.infoBarIds=Object(r.__spread)(t.infoBarIds);var i=t.infoBarHostKey;n&&(a.b[i]||(a.b[i]={}),a.b[i][e]=n)}}));e.a=o},1637:function(t,e,n){"use strict";var r=n(0),a=n(2228),i=n(3);var o=Object(i.mutatorAction)("removeInfoBarMessages",(function(t,e){t&&(Array.isArray(e)?e:e?[e]:t.infoBarIds?Object(r.__spread)(t.infoBarIds):[]).forEach((function(e){return function(t,e){var n=t.infoBarIds&&t.infoBarIds.indexOf(e);n>=0&&t.infoBarIds.splice(n,1);var r=t.infoBarHostKey;a.b[r]&&(delete a.b[r][e],0===Object.keys(a.b[r]).length&&delete a.b[r])}(t,e)}))}));e.a=o},1856:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(1307);function a(t){var e=(Object(r.a)(t)||"").toLowerCase();return!!t&&".fluid"===e}},1885:function(t,e,n){"use strict";var r;n.d(e,"a",(function(){return r})),function(t){t[t.none=0]="none",t[t.refreshing=1]="refreshing",t[t.refreshFailed=2]="refreshFailed",t[t.refreshSucceeded=3]="refreshSucceeded",t[t.attachingAsACopy=4]="attachingAsACopy",t[t.pendingAttachAsACopy=5]="pendingAttachAsACopy"}(r||(r={}))},1886:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"e",(function(){return c})),n.d(e,"f",(function(){return s})),n.d(e,"d",(function(){return u})),n.d(e,"b",(function(){return l}));var r=n(74),a=new r.c((function(){return n.e(915).then(n.bind(null,2821))})),i=new r.b(a,(function(t){return t.extractFileUrlFromOfficeSharePointLink})),o=new r.b(a,(function(t){return t.isLinkPrefixedWithBaseUrl})),c=new r.b(a,(function(t){return t.isSharePointLink})),s=new r.b(a,(function(t){return t.isSharePointServiceGeneratedLink})),u=new r.b(a,(function(t){return t.isOfficeSharePointLink})),l=new r.b(a,(function(t){return t.getParsedQueryStringFromUrl}))},1924:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(0);function a(t){return Object(r.__assign)({__type:"Constant:#Exchange"},t)}},1925:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(0);function a(t){return Object(r.__assign)({__type:"FieldURIOrConstantType:#Exchange"},t)}},1926:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(0);function a(t){return Object(r.__assign)({__type:"RestrictionType:#Exchange"},t)}},1957:function(t,e,n){"use strict";var r=n(20),a=n(3),i={sharingLinks:new r.ObservableMap({})},o=Object(a.createStore)("sharingLinkStore",i);e.a=o},1994:function(t,e,n){"use strict";var r=function(){function t(){this.eventDictionary={}}return t.prototype.on=function(t,e,n){return(this.eventDictionary[t]||(this.eventDictionary[t]=[])).push({callback:e,callbackThis:n}),this},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=(this.eventDictionary[t]||[]).slice();return r.forEach((function(t){return t.callback.apply(t.callbackThis,e)})),this},t.prototype.off=function(t,e){var n=this.eventDictionary[t];if(n){var r=n.filter((function(t){return t.callback!==e}));r.length?this.eventDictionary[t]=r:delete this.eventDictionary[t]}return this},t.prototype.once=function(t,e,n){var r=this,a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return r.off(t,a),e.apply(n,i)};return(this.eventDictionary[t]||(this.eventDictionary[t]=[])).push({callback:a,callbackThis:n}),this},t}();e.a=r},2002:function(t,e,n){"use strict";function r(t){return void 0!==t.recipients}function a(t){return void 0!==t.length}n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return a}))},2003:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(0),a=n(1886),i=n(97),o=n(315);function c(t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,a.b.import()];case 1:return e=n.sent(),[2,s(e(t))]}}))}))}function s(t){if(!Object(i.b)(null==t?void 0:t.nav)){var e={nav:t.nav};return Object(o.stringify)(e)}return null}},2018:function(t,e,n){"use strict";var r;n.d(e,"a",(function(){return r})),function(t){t[t.Initial=0]="Initial",t[t.Adaptive=1]="Adaptive",t[t.Show=2]="Show",t[t.Hide=3]="Hide",t[t.AlwaysHide=4]="AlwaysHide"}(r||(r={}))},2043:function(t,e,n){"use strict";var r;n.d(e,"a",(function(){return r})),function(t){t[t.Blank=0]="Blank",t[t.Loading=1]="Loading",t[t.Error=2]="Error",t[t.Custom=3]="Custom",t[t.Image=4]="Image",t[t.Wac=5]="Wac",t[t.Audio=6]="Audio",t[t.Video=7]="Video",t[t.Text=8]="Text",t[t.NativePdf=9]="NativePdf",t[t.PdfJs=10]="PdfJs",t[t.IFrame=11]="IFrame"}(r||(r={}))},2228:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return a}));var r={};function a(t,e){var n,a=t.infoBarHostKey;return null===(n=r[a])||void 0===n?void 0:n[e]}},2269:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(0);function a(t){return Object(r.__assign)({__type:"And:#Exchange"},t)}},3009:function(t,e,n){"use strict";n.r(e);var r=n(1529),a=n(3);function i(t,e){e&&!t.includes(e)&&t.push(e)}Object(a.mutator)(r.c,(function(t){i(t.sharingLinkIds,t.linkId)})),Object(a.mutator)(r.E,(function(t){var e,n,r;e=t.sharingLinkIds,n=t.linkId,-1!==(r=e.indexOf(n))&&e.splice(r,1)})),Object(a.mutator)(r.d,(function(t){i(t.linkIdContainer,t.linkId)}));var o=n(6473);Object(a.mutator)(o.a,(function(t){var e=t.attachmentWell,n=t.message;e.announcedComponentMessage=n}));var c=n(0),s=n(13563),u=n(11),l=Object(a.action)("REFRESH_SHARING_TIPS_ATTACHMENT_WELL",(function(t,e,n,r,a){return{attachmentWellViewState:t,parentItemId:e,recipientInfo:n,infoBarIds:r,infoBar:a}})),d=n(8702),m=n(11159),h=n(1352);function f(t){var e,n=t.docViewAttachments.concat(t.imageViewAttachments);return(e=n,e.filter((function(t){return t.isCloudy})).map((function(t){return function(t,e){if(1!==t.type)return null;var n=t.model;return{id:t.id,name:n.Name,supportsDownsell:e,currentPermissionLevel:n.PermissionType,sharingInfo:t.info.sharingInfo,sharingRecipientsInfo:{recipientPermissionInfos:[]},sharingTipsIgnored:[],typeOfLink:"referenceAttachment"}}(Object(h.a)(t.attachmentId),t.strategy.isConvertCloudyToClassicSupported)}))).filter((function(t){var e;return null===(e=t.sharingInfo)||void 0===e?void 0:e.getSharingInfoSucceeded}))}var b=n(266),p=n(1629),I=n(1637),v=n(1752),g=n(1887);function O(t,e,n,r){return A(t,f(e),n,[],null,r,!0,null)}function A(t,e,n,r,a,i,o,c){for(var s,u=0;u<t.length;u++){var l=j(t[u],e,n,r,a,i,o,c);l&&(s=l)}if("function"==typeof s){var d=s(null);if((null==d?void 0:d.messageParts)&&d.messageParts.length>0&&"string"==typeof d.messageParts[0])return d.messageParts[0]}else if("object"==typeof s&&s.length>0)return s[0];return null}function j(t,e,n,r,a,i,o,c){var s=i(e,t,n,o,c);return Object(I.a)(a,[t]),s&&(Object(p.a)(a,t,s),r.push(t)),s}Object(a.orchestrator)(l,(function(t){return Object(c.__awaiter)(void 0,void 0,void 0,(function(){var e,n,r,a,i,o,l,p,I,O,j;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return e=t.attachmentWellViewState,n=t.parentItemId,r=t.recipientInfo,a=t.infoBarIds,i=t.infoBar,o=f(e),l=new b.b("AttachmentRefreshSharingTips"),p=function(t){var r=Object(d.a)(e,t);if(r){var a=Object(h.a)(r.attachmentId);return{text:Object(u.b)(s.a),action:function(){var t=a.model;Object(b.q)("SharingTipsConvertToClassic"),Object(v.f)(r,n.Id,t.AttachLongPathName,t.PermissionType,(function(t,n,r,a){Object(m.a)(e,t,n,r,a)}),1)}}}return null},I=Object(g.d)(),O=[],[4,g.f.import()];case 1:return j=c.sent(),A(I,o,r,O,i,j,!1,p),function(t,e){var n=Object(g.d)(),r=t.filter((function(t){return-1!==n.indexOf(t)})),a=e.filter((function(t){return-1===r.indexOf(t)})),i=r.filter((function(t){return-1===e.indexOf(t)}));0!==a.length&&Object(b.q)("AttachmentSharingTipAdded",a);0!==i.length&&Object(b.q)("AttachmentSharingTipsRemoved",i)}(a,O),Promise.resolve().then((function(){return l.end()})),[2]}}))}))}));Object(a.orchestrator)(o.a,(function(t){return Object(c.__awaiter)(void 0,void 0,void 0,(function(){var e;return Object(c.__generator)(this,(function(n){return e=t.attachmentWell,null!==t.message&&setTimeout((function(){Object(o.a)(e,null)}),2e3),[2]}))}))}));var C=n(8703),_=n(72),y=n(2944),w=n(2767);var S=n(4411),k=n(2853),T=n(5688),F=n(3165),P=n(5606);var x=Object(_.d)("initializeAttachments",T.a.AttachmentWellInitialization)((function(t,e,n,r,a,i,o,s,u){if(t){var l=function(t){return t?Object(v.o)().filter((function(e){return!t.includes(e)})):null}(i);s&&n.docViewAttachments.length>0&&n.docViewAttachments.forEach((function(t){var e;(function(t){var e=Object(h.a)(t);if(null==e?void 0:e.model){return"IPM.Appointment"===e.model.EmbeddedItemClass}return!1})(t.attachmentId)&&((e=t.strategy).previewMethod=w.a.Unsupported,e.supportedOpenActions=e.supportedOpenActions.filter((function(t){return t!==y.a.Preview})))})),n.isInitialized||t.forEach((function(t){!function(t,e,n,r,a,i,o){if(!("application/x-sharing-metadata-xml"===t.ContentType||o&&Object(k.a)(t))){var s=Object(v.h)(Object(c.__assign)(Object(c.__assign)({},t.AttachmentId),{mailboxInfo:e}),t,n.isReadOnly,!0,r,o,null,a,!0),u=!!n.parentItemIdMap;if(t.IsInline&&t.__type!==F.d&&t.ContentId&&""!=t.ContentId&&"unknown"!=t.ContentId.toLowerCase()?n.inlineAttachments.push(Object(v.i)(t.AttachmentId,t.AttachmentId.Id,!0,4)):Object(S.a)(t)&&!u?n.imageViewAttachments.push(s):n.docViewAttachments.push(s),s.isCloudy){var l=Object(h.a)(s.attachmentId);l.requiresFetchingSharingInformation&&i&&Object(v.m)(l)}else Object(P.a)(n,t.Size,t.AttachmentId)}}(t,e,n,r,l,o,u)})),n.supportedMenuActions=l,n.isInitialized=!0}}));var N=n(281),B=Object(N.action)("reinitializeAttachments")((function(t,e,n,r,a){t&&(n.docViewAttachments=[],n.imageViewAttachments=[],n.inlineAttachments=[],n.isInitialized=!1,x(t,e,n,r,!1,a))})),E=n(4754);function R(t,e){var n=Object(E.a)(!1,void 0===e,t);if(e){var r=e.attachments,a=e.mailboxInfo,i=e.parentItemId;x(r,a,n,!0,!0,null,i)}return n}var D=n(8704);function L(t,e){var n=Object(E.a)(!0,!1,"");return Object(c.__assign)(Object(c.__assign)({},n),{parentItemIdMap:t,itemReceivedTimeMap:e,isVisible:!1,maxHeight:0})}var U=n(4059),M=n(2016),W=n(2229),H=function(t,e,n,r){if(t){var a=t.docViewAttachments,i=t.imageViewAttachments,o=t.inlineAttachments.filter((function(t){var r=Object(h.a)(t.attachmentId);if((null==r?void 0:r.model)&&"HTML"===n){var a=e;return a&&!Object(W.l)(a,r.model)}return!1})),s=Object(c.__spread)(a,i,o);return r?s.filter((function(t){return Object(M.b)(t.attachmentId.Id)})):s.filter((function(t){return!Object(M.b)(t.attachmentId.Id)}))}return[]},z=n(5231),V=n(3918),q=n(4409),G=n(7603),Q=n(1434),K=n(1516),J=n(1598);function X(t,e,n,r,a,i){return Object(c.__awaiter)(this,void 0,void 0,(function(){var o,s,u,l;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return[4,K.c.import()];case 1:return o=c.sent(),s=n.filter((function(t){return e=t,!(Object(J.a)(e)&&e.IsInline);var e})).map(o),u=s.filter((function(t){return t.fileType===Q.a.Cloud})),(l=s.filter((function(t){return t.fileType===Q.a.AttachmentItem}))).length>0&&$(e,t,l,r,!1,!1,a,i),u.length>0&&$(e,t,u,r,!1,!0,a,i),[2]}}))}))}function $(t,e,n,r,a,i,o,s){var u={isInline:a,isHiddenInline:!1},l=i?Object(c.__assign)(Object(c.__assign)({},u),{shouldShare:!0}):Object(c.__assign)(Object(c.__assign)({},u),{shouldShare:!1});K.f.import().then((function(a){a(t,e,n,r,l,null,o,s)}))}var Y=n(6524),Z=Object(a.mutatorAction)("mergeToConversationAttachmentWell",(function(t,e,n,r){t&&(t.docViewAttachments.forEach((function(t){tt(t,e,n,r)})),t.imageViewAttachments.forEach((function(t){tt(t,e,n,r)})))}));function tt(t,e,n,r){e.parentItemIdMap[t.attachmentId.Id]||(e.docViewAttachments.push(Object(c.__assign)({},t)),e.parentItemIdMap[t.attachmentId.Id]=n,e.itemReceivedTimeMap[t.attachmentId.Id]=r)}var et=Object(a.mutatorAction)("sortConversationAttachmentWell",(function(t,e){t.docViewAttachments=t.docViewAttachments.sort((function(n,r){return(e?1:-1)*(new Date(t.itemReceivedTimeMap[n.attachmentId.Id]).getTime()-new Date(t.itemReceivedTimeMap[r.attachmentId.Id]).getTime())}))})),nt=n(2181),rt=Object(a.mutatorAction)("convertImageViewAttachmentToInlineAttachment",(function(t,e,n){var r=Object(h.a)(e.attachmentId);if(r){var a=t.imageViewAttachments,i=t.inlineAttachments,o=a.indexOf(e);if(o>=0){a.splice(o,1),r.model.ContentId=n,r.model.IsInline=!0,r.model.AttachmentOriginalUrl=Object(nt.b)(e.attachmentId,1);var c=Object(v.i)(e.attachmentId,e.attachmentId.Id,!1);c.status=3,i.push(c)}}})),at=n(8707);n.d(e,"refreshSharingTipsAttachmentWell",(function(){return l})),n.d(e,"addAttachmentIntoWellBeforeUpload",(function(){return C.a})),n.d(e,"initializeAttachments",(function(){return x})),n.d(e,"reinitializeAttachments",(function(){return B})),n.d(e,"getAttachmentWellForCompose",(function(){return R})),n.d(e,"getAttachmentWellInitialValue",(function(){return E.a})),n.d(e,"getAvailableLocalAttachmentSize",(function(){return D.a})),n.d(e,"getConversationAttachmentWellInitialValue",(function(){return L})),n.d(e,"getMaxClassicAttachmentsSize",(function(){return U.a})),n.d(e,"getAllValidAttachments",(function(){return H})),n.d(e,"createAttachmentFullViewStateAndStoreBackingModel",(function(){return z.a})),n.d(e,"setInlineAttachmentStatus",(function(){return V.a})),n.d(e,"createAttachmentFullViewState",(function(){return q.a})),n.d(e,"createAttachmentsViaQueueManager",(function(){return G.a})),n.d(e,"deleteAttachmentViaQueueManager",(function(){return G.b})),n.d(e,"createAttachmentsFromRecentAttachments",(function(){return X})),n.d(e,"createAttachmentFileFromExistingMailboxAttachment",(function(){return Y.a})),n.d(e,"mergeToConversationAttachmentWell",(function(){return Z})),n.d(e,"sortConversationAttachmentWell",(function(){return et})),n.d(e,"convertImageViewAttachmentToInlineAttachment",(function(){return rt})),n.d(e,"getLastCloudyAttachmentsSharingIssueForBlockOnSend",(function(){return O})),n.d(e,"uploadLocalFile",(function(){return at.a}))},3389:function(t,e,n){"use strict";var r,a=n(3),i={uploadFolders:new(n(20).ObservableMap)},o=Object(a.createStore)("attachmentsUploadFolderStore",i),c=n(96);!function(t){t.User="User",t.Group="Group"}(r||(r={}));var s=Object(a.action)("preloadUploadFolder",(function(t,e){return void 0===t&&(t=Object(c.h)().SessionSettings.UserEmailAddress),void 0===e&&(e=r.User),{mailboxId:t,uploadFolderMailboxType:e}})),u=Object(a.action)("uploadFolderLoaded",(function(t,e){return{mailboxId:t,uploadFolder:e}}));Object(a.mutator)(u,(function(t){var e=t.mailboxId,n=t.uploadFolder;o().uploadFolders.set(e,n)}));var l=n(0),d=n(4110),m=n(11),h=n(267),f=n(97),b="Email attachments";function p(t){switch(t){case r.Group:return b;case r.User:return Object(m.b)(d.a);default:return Object(h.a)(t)}}var I=n(29);var v=n(1410);function g(t,e){switch(e){case r.Group:var n=new Headers;return Object(v.f)(t,n),n;case r.User:return null;default:return Object(h.a)(e)}}function O(t){return void 0===t&&(t=Object(c.h)().SessionSettings.UserEmailAddress),o().uploadFolders.get(t)||null}var A=n(56);function j(t,e){return void 0===t&&(t=null),void 0===e&&(e=r.User),Object(l.__awaiter)(this,void 0,void 0,(function(){var n,r,a,i;return Object(l.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=t||Object(c.h)().SessionSettings.UserEmailAddress,(n=O(t))?[2,n]:[4,(s={},l={headers:g(t,e)},Object(I.a)("GetAttachmentDataProviderUploadFolderProps",s,l))];case 1:return r=o.sent(),a=function(t,e,n){return{mailboxId:t,folderId:n.FolderId,folderName:Object(f.b)(n.FolderName)?p(e):n.FolderName}}(t,e,r),u(t,a),[2,a];case 2:return i=o.sent(),A.g.warn("fetchUploadFolder got error: "+i.message),[2,null];case 3:return[2]}var s,l}))}))}Object(a.orchestrator)(s,(function(t){return Object(l.__awaiter)(void 0,void 0,void 0,(function(){var e,n;return Object(l.__generator)(this,(function(r){switch(r.label){case 0:return e=t.mailboxId,n=t.uploadFolderMailboxType,O(e)?[3,2]:[4,j(e,n)];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))})),n.d(e,"d",(function(){return s})),n.d(e,"b",(function(){return j})),n.d(e,"c",(function(){return O})),n.d(e,"a",(function(){return r}))},400:function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return s}));var r=n(0),a=n(14),i=n(342),o=function(){return{position:"absolute",width:1,right:31,top:8,bottom:8}};function c(t){var e,n,i,c,s,u=t.semanticColors,l=t.palette,d=u.buttonBackground,m=u.buttonBackgroundPressed,h=u.buttonBackgroundHovered,f=u.buttonText,b=u.buttonTextHovered,p=u.buttonTextChecked,I=u.buttonTextCheckedHovered;return{root:{backgroundColor:d,color:f},rootHovered:{backgroundColor:h,color:b,selectors:(e={},e[a.HighContrastSelector]={borderColor:"Highlight",color:"Highlight"},e)},rootPressed:{backgroundColor:m,color:p},rootExpanded:{backgroundColor:m,color:p},rootChecked:{backgroundColor:m,color:p},rootCheckedHovered:{backgroundColor:m,color:I},rootDisabled:{selectors:(n={},n[a.HighContrastSelector]={color:"GrayText",borderColor:"GrayText",backgroundColor:"Window"},n)},splitButtonContainer:{selectors:(i={},i[a.HighContrastSelector]={border:"none"},i)},splitButtonMenuButton:{color:l.white,backgroundColor:"transparent",selectors:{":hover":{backgroundColor:l.neutralLight,selectors:(c={},c[a.HighContrastSelector]={color:"Highlight"},c)}}},splitButtonMenuButtonDisabled:{backgroundColor:u.buttonBackgroundDisabled,selectors:{":hover":{backgroundColor:u.buttonBackgroundDisabled}}},splitButtonDivider:Object(r.__assign)(Object(r.__assign)({},o()),{backgroundColor:l.neutralTertiaryAlt,selectors:(s={},s[a.HighContrastSelector]={backgroundColor:"WindowText"},s)}),splitButtonDividerDisabled:{backgroundColor:t.palette.neutralTertiaryAlt},splitButtonMenuButtonChecked:{backgroundColor:l.neutralQuaternaryAlt,selectors:{":hover":{backgroundColor:l.neutralQuaternaryAlt}}},splitButtonMenuButtonExpanded:{backgroundColor:l.neutralQuaternaryAlt,selectors:{":hover":{backgroundColor:l.neutralQuaternaryAlt}}},splitButtonMenuIcon:{color:u.buttonText},splitButtonMenuIconDisabled:{color:u.buttonTextDisabled}}}function s(t){var e,n,c,s,u,l,d,m,h,f=t.palette,b=t.semanticColors;return{root:{backgroundColor:b.primaryButtonBackground,border:"1px solid "+b.primaryButtonBackground,color:b.primaryButtonText,selectors:(e={},e[a.HighContrastSelector]={color:"Window",backgroundColor:"WindowText",borderColor:"WindowText",MsHighContrastAdjust:"none"},e["."+i.a+" &:focus"]={selectors:{":after":{border:"none",outlineColor:f.white}}},e)},rootHovered:{backgroundColor:b.primaryButtonBackgroundHovered,border:"1px solid "+b.primaryButtonBackgroundHovered,color:b.primaryButtonTextHovered,selectors:(n={},n[a.HighContrastSelector]={color:"Window",backgroundColor:"Highlight",borderColor:"Highlight"},n)},rootPressed:{backgroundColor:b.primaryButtonBackgroundPressed,border:"1px solid "+b.primaryButtonBackgroundPressed,color:b.primaryButtonTextPressed,selectors:(c={},c[a.HighContrastSelector]={color:"Window",backgroundColor:"WindowText",borderColor:"WindowText",MsHighContrastAdjust:"none"},c)},rootExpanded:{backgroundColor:b.primaryButtonBackgroundPressed,color:b.primaryButtonTextPressed},rootChecked:{backgroundColor:b.primaryButtonBackgroundPressed,color:b.primaryButtonTextPressed},rootCheckedHovered:{backgroundColor:b.primaryButtonBackgroundPressed,color:b.primaryButtonTextPressed},rootDisabled:{selectors:(s={},s[a.HighContrastSelector]={color:"GrayText",borderColor:"GrayText",backgroundColor:"Window"},s)},splitButtonContainer:{selectors:(u={},u[a.HighContrastSelector]={border:"none"},u)},splitButtonDivider:Object(r.__assign)(Object(r.__assign)({},o()),{backgroundColor:f.white,selectors:(l={},l[a.HighContrastSelector]={backgroundColor:"Window"},l)}),splitButtonMenuButton:{backgroundColor:b.primaryButtonBackground,color:b.primaryButtonText,selectors:(d={},d[a.HighContrastSelector]={backgroundColor:"WindowText"},d[":hover"]={backgroundColor:b.primaryButtonBackgroundHovered,selectors:(m={},m[a.HighContrastSelector]={color:"Highlight"},m)},d)},splitButtonMenuButtonDisabled:{backgroundColor:b.primaryButtonBackgroundDisabled,selectors:{":hover":{backgroundColor:b.primaryButtonBackgroundDisabled}}},splitButtonMenuButtonChecked:{backgroundColor:b.primaryButtonBackgroundPressed,selectors:{":hover":{backgroundColor:b.primaryButtonBackgroundPressed}}},splitButtonMenuButtonExpanded:{backgroundColor:b.primaryButtonBackgroundPressed,selectors:{":hover":{backgroundColor:b.primaryButtonBackgroundPressed}}},splitButtonMenuIcon:{color:b.primaryButtonText},splitButtonMenuIconDisabled:{color:f.neutralTertiary,selectors:(h={},h[a.HighContrastSelector]={color:"GrayText"},h)}}}},4056:function(t){t.exports=JSON.parse('{"a":"Paa"}')},4059:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(3165),a=n(20),i=n(30),o=25*r.b;function c(){return s.get()}var s=Object(a.computed)((function(){var t=Object(i.a)();return t&&t.SessionSettings?(t.SessionSettings.MaxMessageSizeInKb-2048)*r.a:o}))},4110:function(t){t.exports=JSON.parse('{"a":"Zsa"}')},4452:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(0);function a(t){return Object(r.__assign)({__type:"CreateAttachmentJsonRequest:#Exchange"},t)}},4535:function(t,e,n){"use strict";var r=n(29),a=n(0);function i(t,e){var n;return void 0===t||t.__type||(n=t,t=Object(a.__assign)({__type:"DeleteAttachmentJsonRequest:#Exchange"},n)),Object(r.a)("DeleteAttachment",t,e)}n.d(e,"a",(function(){return i}))},463:function(t,e,n){"use strict";var r=n(0),a=n(1),i=n(394),o=n(461),c=n(460),s=n(14),u=n(234),l=n(395),d=n(428),m=n(400),h=Object(u.c)((function(t,e,n){var r=Object(l.a)(t),a=Object(d.a)(t),i={root:{minWidth:"80px",height:"32px"},label:{fontWeight:s.FontWeights.semibold}};return Object(s.concatStyleSets)(r,i,n?Object(m.a)(t):Object(m.b)(t),a,e)}));n.d(e,"a",(function(){return f}));var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(r.__extends)(e,t),e.prototype.render=function(){var t=this.props,e=t.primary,n=void 0!==e&&e,c=t.styles,s=t.theme;return a.createElement(i.a,Object(r.__assign)({},this.props,{variantClassName:n?"ms-Button--primary":"ms-Button--default",styles:h(s,c,n),onRenderDescription:o.b}))},e=Object(r.__decorate)([Object(c.a)("DefaultButton",["theme","styles"],!0)],e)}(a.Component)},4754:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r,a=n(4059);function i(t,e,n){return r||(r=Object(a.a)()),{composeId:n,allowShowMultipleRows:!t,didViewOverflowOneRow:!1,canOverrideAllowShowMultipleRows:!0,docViewAttachments:[],imageViewAttachments:[],inlineAttachments:[],isInitialized:e,isReadOnly:t,groupId:null,maxTotalClassicAttachmentSize:r,totalClassicAttachmentSize:0,saveAllToCloudStatus:0,supportedMenuActions:null,sharingLinkIds:[],announcedComponentMessage:null}}},4816:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(0);function a(t){return Object(r.__assign)({__type:"CreateAttachmentRequest:#Exchange"},t)}},523:function(t,e,n){"use strict";var r,a=n(0),i=n(1),o=n(729),c=n(56);!function(t){t[t.Full=0]="Full",t[t.Simple=1]="Simple",t[t.None=2]="None"}(r||(r={}));var s=function(t){function e(e){var n=t.call(this,e)||this;return n.state={},n}return Object(a.__extends)(e,t),e.prototype.componentDidCatch=function(t,e){var n,r;null===(r=(n=this.props).onError)||void 0===r||r.call(n,t,e),this.props.suppressErrorReport||(t.component=!0,t.diagnosticInfo=(t.diagnosticInfo||"")+e.componentStack,Object(c.d)(t)),this.setState({error:t})},e.prototype.render=function(){var t=this.state.error,e=this.props,n=e.children,o=e.type,c=e.windowIcons;if(t){if(o==r.None)return null;if(o==r.Simple||!this.props.fullErrorComponent)return i.createElement("div",null,t);var s=this.props.fullErrorComponent;return i.createElement(s,Object(a.__assign)({error:t,windowIcons:c},this.props.fullErrorComponentProps))}return n},e=Object(a.__decorate)([o.observer],e)}(i.Component);n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return r}))},5687:function(t,e,n){"use strict";var r=n(0),a=n(1352),i=n(1905),o=n(4410),c=n(1761),s=n(2181),u=n(281);e.a=Object(u.action)("refreshThumbnailImageUrl")((function(t,e,n){return void 0===n&&(n=!1),Object(r.__awaiter)(this,void 0,void 0,(function(){var u,l;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(u=Object(a.a)(t),!Object(c.b)(u.model))return[3,7];switch(u.model.ProviderType){case i.e:return[3,1]}return[3,5];case 1:return r.trys.push([1,3,,4]),[4,Object(o.a)(u.model)];case 2:return l=r.sent(),u.thumbnailImage.url=l,[3,4];case 3:return r.sent(),u.thumbnailImage.url=null,[3,4];case 4:case 5:return[3,6];case 6:return[3,8];case 7:l=Object(s.a)(t,u.model,2,Object(c.b)(u.model),e,n),u.thumbnailImage.url=l,r.label=8;case 8:return[2]}}))}))}))},5688:function(t,e,n){"use strict";e.a={AttachmentCreationClassicFromLocalFile:{name:"AttachmentCreationClassicFromLocalFile",customData:function(t,e,n,r,a){return r?[r.size]:[0]}},AttachmentCreationFromRecentAttachment:{name:"AttachmentCreationFromRecentAttachment",customData:function(t,e,n,r,a,i){return[(null==r?void 0:r.size)||0,null==r?void 0:r.fileType]}},AttachmentCreationCloudyFromAttachmentDataProvider:{name:"AttachmentCreationCloudyFromAttachmentDataProvider",customData:function(t,e,n,r){return[n.providerType,n.fileType]}},AttachmentCreationCloudyFromLocalFile:{name:"AttachmentCreationCloudyFromLocalFile"},AttachmentDeletionAction:{name:"AttachmentDeletionAction",customData:function(t,e,n,r){return{generatedAttachmentId:e.attachmentId.Id}},cosmosOnlyData:function(t,e,n,r){return JSON.stringify({attachmentId:e.attachmentId.Id,fileType:r})},options:{isCore:!0}},AttachmentWellInitialization:{name:"AttachmentWellInitialization",customData:function(t,e,n,r,a,i,o){return{hasAttachments:t&&t.length>0,isCompose:a}},options:{sessionSampleRate:1}}}},6473:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(3),a=Object(r.action)("setAnnouncedComponentMessage",(function(t,e){return{attachmentWell:t,message:e}}))},6489:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(0);function a(t){return Object(r.__assign)({__type:"ReferenceAttachment:#Exchange"},t)}},6524:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(1434),a=n(1598),i=n(1535);function o(t){if(Object(a.a)(t)){var e=t;return{fileType:r.a.Cloud,name:e.Name,size:e.Size,providerId:"",providerType:4,location:e.AttachLongPathName,providerEndpointUrl:"",isFolder:!1,thumbnailUrl:e.AttachmentThumbnailUrl,previewUrl:e.AttachmentPreviewUrl,fileId:e.AttachmentId.Id,fileParentId:"",type:e.ContentType}}return{attachmentItemId:t.AttachmentId.Id,name:t.Name,size:t.Size,fileType:r.a.AttachmentItem,type:i.c,EmbeddedItemClass:t.EmbeddedItemClass,ContentType:t.ContentType}}},6938:function(t,e,n){"use strict";var r=n(0),a=n(281),i=n(10),o=n(7348);function c(t){return Object(r.__assign)({__type:"SetAttachmentPermissionsRequest:#Exchange"},t)}var s=n(29);function u(t,e,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var a,i,o=function(t,e,n,r){return void 0===n&&(n=null),void 0===r&&(r=!1),c({AttachmentIds:t,PermissionLevel:e,NewAttachLongPathNames:n,SetToOriginalPermissionLevel:r})}(t,e,n,r);return void 0===(a={request:o}).request||a.request.__type||(a.request=c(a.request)),Object(s.a)("SetAttachmentPermissionsV2",a,i)}e.a=Object(a.action)("changeAttachmentPermission")((function(t,e,n,a){return void 0===n&&(n=null),void 0===a&&(a=!1),Object(r.__awaiter)(this,void 0,void 0,(function(){var c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,u(t.map((function(t){return t.Id})),e,n,a)];case 1:if(!(c=r.sent()).OperationSucceeded||!c.NewAttachLongPathNames||c.NewAttachLongPathNames.length!==t.length)throw new Error("Error setting attachment permissions");return t.forEach((function(t,n){var r,a=null;(null===(r=c.ExpirationDates)||void 0===r?void 0:r[n])&&(a=Object(i.lc)(c.ExpirationDates[n])),Object(o.a)(t,e,c.NewAttachLongPathNames[n],a)})),[2]}}))}))}))},7221:function(t){t.exports=JSON.parse('{"a":"Vib"}')},7222:function(t,e,n){"use strict";var r=n(281);e.a=Object(r.action)("updateChangeKeyOnItemId")((function(t,e){t.ChangeKey=e}))},7348:function(t,e,n){"use strict";var r=n(2227),a=n(1352),i=n(6496),o=n(77),c=n(281);e.a=Object(c.action)("setAttachmentPermissionLevel")((function(t,e,n,c){var s=Object(a.a)(t),u=s.model;u.PermissionType=e,n&&(u.AttachLongPathName=n,s.openUrl=Object(i.a)(u)),Object(o.i)("doc-attachment-referenceAttachmentExpiration")&&s.info&&s.info.sharingInfo&&(s.info.sharingInfo.expirationDate=c),Object(r.a)(t)}))},756:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(0),a=n(1),i=n(461),o=n(460),c=n(463),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(r.__extends)(e,t),e.prototype.render=function(){return a.createElement(c.a,Object(r.__assign)({},this.props,{primary:!0,onRenderDescription:i.b}))},e=Object(r.__decorate)([Object(o.a)("PrimaryButton",["theme","styles"],!0)],e)}(a.Component)},7603:function(t,e,n){"use strict";var r=n(8705),a=n(11),i=n(1778),o=n(1779),c=n(4925),s=n(266),u=n(267),l=n(1352),d=n(1345),m=n(0),h=n(10369),f=n(10370);var b=n(8703),p=n(1752),I=n(56),v=n(281),g=n(1437),O=n(1485),A=n(7348),j=n(3392);var C=n(4758),_=n(6473),y=n(7222),w=n(13566);function S(t,e,n,r,i,o,c){Object(_.a)(c,Object(a.b)(w.a)),Object(p.E)(t,e,n,r,o),Object(y.a)(i,r.AttachmentId.RootItemChangeKey),function(t,e,n){n&&0===n.ResultCode&&0===t.attachmentType&&(n.CanShareInternally||Object(j.f)(e.PermissionType)||(Object(s.q)("AttachmentsCanNotShareInternally"),Object(A.a)(t.attachmentId,0)),Object(O.o)(e.AttachmentId))}(t,n,o)}function k(t,e,n,r){1===t.attachmentType&&Object(p.z)(t,2),e&&Object(C.a)(e,t),n&&r&&g.g.importAndExecute(n,r)}var T=Object(v.action)("handleCreateAttachmentNotification")((function(t,e,n,r,a,i,o,c){var s=t;try{if(0!==s.ResultCode)throw new Error("ResultCode:"+s.ResultCode+", Id:"+s.Id+", Exception: "+s.Exception);var u=s.Response.ResponseMessages.Items[0];if(u&&u.Attachments.length>0)return Object(p.C)(a.attachmentId,!0),i(u.Attachments[0]),void S(a,n,r,u.Attachments[0],e,s.Response.SharingInformation,c.attachmentWellViewState)}catch(t){I.d("Error handling the create attachment notification: "+t)}Object(p.C)(a.attachmentId,!1),o(new Error(s.Exception)),k(a,c.attachmentWellViewState,null,null)})),F=n(361);function P(t,e){return Object(m.__awaiter)(this,void 0,void 0,(function(){var n,r,a,i;return Object(m.__generator)(this,(function(o){switch(o.label){case 0:return n=Object(F.a)(),r={subscriptionId:n,requiresExplicitSubscribe:!1,subscriptionParameters:null},a=function(t){e(t),g.g.importAndExecute(r,a)},[4,g.f.import()];case 1:return o.sent()(r,a),[4,g.b.import()];case 2:return i=o.sent()(),t(n,r,i,a),[2]}}))}))}var x=n(29),N=n(728);var B=n(443);function E(t,e,n,r,a,i){return Object(m.__awaiter)(this,void 0,void 0,(function(){var o;return Object(m.__generator)(this,(function(c){switch(c.label){case 0:return o=Object(B.a)(t.mailboxInfo)||{},[4,(s={itemId:t,attachmentDataProviderId:n.providerId,location:n.location,attachmentId:n.fileId||"",subscriptionId:r,channelId:a,dataProviderParentItemId:n.fileParentId||"",providerEndpointUrl:n.providerEndpointUrl,cancellationId:e,isInline:i},u=o,void 0===s.itemId||s.itemId.__type||(s.itemId=Object(N.a)(s.itemId)),Object(x.a)("CreateAttachmentFromAttachmentDataProvider",s,u))];case 1:return[2,c.sent()]}var s,u}))}))}var R=n(3165),D=Object(v.action)("createAttachmentFromAttachmentDataProvider")((function(t,e,n,r,a,i,o,c,u){return Object(m.__awaiter)(this,void 0,void 0,(function(){var l,d,h,f=this;return Object(m.__generator)(this,(function(b){return(l=new s.b("AttachmentCreationClassicFromAttachmentDataProvider")).addCustomData([a.providerType]),d=function(t){o(t),l.end()},h=function(t){c(),l.endWithError("ServerError",t)},P((function(e,n,o,s){return Object(m.__awaiter)(f,void 0,void 0,(function(){var l;return Object(m.__generator)(this,(function(d){switch(d.label){case 0:if(d.trys.push([0,2,,3]),0===a.providerType&&(m=a.name,-1!==m.indexOf("%")||-1!==m.indexOf("#")))throw new Error(R.c);return 0===i.attachmentType&&Object(p.B)(Object(p.k)(a.size),.05,(function(t){Object(p.x)(i,t)}),i.attachmentId),[4,E(t,r,a,e,o,!1)];case 1:if(!d.sent())throw new Error("Empty response for createAttachmentFromAttachmentDataProvider request");return[3,3];case 2:return l=d.sent(),Object(p.C)(i.attachmentId,!1),c(l),k(i,u.attachmentWellViewState,n,s),[2];case 3:return[2]}var m}))}))}),(function(r){T(r,t,e,n,i,d,h,u)})),[2]}))}))}));var L=n(5688),U=n(1410);function M(t,e,n,r,a,i){var o=this;return new Promise((function(c,s){return Object(m.__awaiter)(o,void 0,void 0,(function(){var o,u,l;return Object(m.__generator)(this,(function(d){switch(d.label){case 0:return(o=new XMLHttpRequest).onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var t=void 0;try{t=JSON.parse(o.responseText)}catch(t){I.d("Attachment: Deserialize response failed with error: "+t.Message),I.d("Attachment: Deserialize response Failure Stack Trace: "+t.stack),s(t)}c(t)}else s(new Error("Request failed with status "+o.status+". Message: "+o.responseText))},o.ontimeout=function(){s(new Error("Request timed out"))},i&&(o.upload.onprogress=i),o.open("POST",t,!0),o.setRequestHeader("X-OWA-Action",n),[4,Object(U.d)(r)];case 1:return(u=d.sent())&&Object.keys(u).forEach((function(t){o.setRequestHeader(t,u[t])})),l=JSON.stringify(e),a?(o.setRequestHeader("X-OWA-UrlPostData",encodeURI(l)),o.send(a)):o.send(l),[2]}}))}))}))}var W=n(6);function H(t){var e=Object(W.a)();return e.baseUrl?""+e.baseUrl+t:"/owa"+t}var z=n(4452),V=n(4816),q=n(317),G=n(340),Q={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddAttachmentToDraft"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AddAttachmentToDraftOptions"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addAttachmentToDraft"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"OwsTypeName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"AttachmentId"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"AttachmentOriginalUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"ContentId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"ContentLocation"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"ContentType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"IsInline"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"IsInlineToNormalBody"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"IsInlineToUniqueBody"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"LastModifiedTime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"Name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"Size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"Thumbnail"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"ThumbnailMimeType"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"isCancelled"},arguments:[],directives:[]}]}}]}}]},K=n(77),J=H("/service.svc/CreateAttachmentFromLocalFile");function X(t,e,n,r,a,i){return Object(m.__awaiter)(this,void 0,void 0,(function(){var o,c,s,u,l,d;return Object(m.__generator)(this,(function(h){switch(h.label){case 0:return I.g.info("Attachment: createAttachment Id: "+t.Id+", ChangeKey: "+t.ChangeKey),Object(K.i)("mon-cmp-graphQLAttachments")?(o=function(t){var e,n=Object(m.__assign)(Object(m.__assign)({},t),{AttachmentId:{Id:null===(e=t.AttachmentId)||void 0===e?void 0:e.Id},OwsTypeName:t.__type});return delete n.__type,n}(e),[4,Object(G.a)()]):[3,3];case 1:return[4,h.sent().mutate({variables:{options:{ParentItemId:t,Attachments:[o],CancellationId:n,attachmentType:"LocalFile",fileBlob:r,mailboxInfo:t.mailboxInfo,isInline:e.IsInline,sliceInformation:i}},mutation:Q})];case 2:return c=h.sent(),s=c.data.addAttachmentToDraft,[2,{ResponseMessages:{Items:[{Attachments:s.attachments,IsCancelled:s.isCancelled}]}}];case 3:return u=Object(V.a)({ParentItemId:t,Attachments:[e],RequireImageType:e.IsInline,IncludeContentIdInResponse:e.IsInline,ClientSupportsIrm:!0,CancellationId:n}),i&&(u.SliceNumber=i.sliceNumber,u.TotalSlices=i.totalSlices),l=Object(z.a)({Header:Object(q.b)(),Body:u}),d=e,[4,M(J,l,"CreateAttachmentFromLocalFile",t.mailboxInfo,d&&r?r:null,a)];case 4:return[2,h.sent().Body]}}))}))}function $(t,e){var n="Attachment: createAttachment failed",r=null!=e?e:"genericError";return(null==t?void 0:t.MessageText)&&(n+=" with MessageText: "+t.MessageText),I.g.warn(n),(null==t?void 0:t.ResponseCode)&&(r=t.ResponseCode),{errorMessage:n,errorCode:r}}function Y(t){var e=Object(m.__assign)({},t);return Object.keys(e).forEach((function(t,n){null===e[t]&&(e[t]=void 0)})),e}var Z=n(72),tt=Object(Z.d)("createAttachmentFromLocalFile",L.a.AttachmentCreationClassicFromLocalFile)((function(t,e,n,r,a){return Object(m.__awaiter)(this,void 0,void 0,(function(){var i,o,c,s;return Object(m.__generator)(this,(function(u){switch(u.label){case 0:return i=null,0===a.attachmentType&&(i=function(t){var e=t.loaded/t.total;Object(p.x)(a,e)}),o=Y(e),[4,X(t,o,n,r,i)];case 1:if(c=u.sent(),(s=c.ResponseMessages.Items[0])&&s.Attachments.length>0&&s.Attachments[0])return[2,{attachment:s.Attachments[0],sharingInfo:null}];throw $(s)}}))}))})),et=n(6658),nt=Object(Z.d)("createAttachmentFromMailboxFile",L.a.AttachmentCreationFromRecentAttachment)((function(t,e,n,r,a,i){return Object(m.__awaiter)(this,void 0,void 0,(function(){var o,c,s,u;return Object(m.__generator)(this,(function(l){switch(l.label){case 0:return o=null,0===a.attachmentType&&(o=function(t){var e=t.loaded/t.total;Object(p.x)(a,e)}),c=Y(e),i&&(c=function(t,e){return Object(et.a)({AttachmentId:t.AttachmentId,AttachmentIdToAttach:e,ContentType:t.ContentType,Name:t.Name,Size:t.Size,Thumbnail:t.Thumbnail,ThumbnailMimeType:t.ThumbnailMimeType,CreateAttachmentInlineType:2})}(c,r.fileId)),[4,X(t,c,n,null,o)];case 1:if(s=l.sent(),(u=s.ResponseMessages.Items[0])&&u.Attachments.length>0&&u.Attachments[0])return[2,{attachment:u.Attachments[0],sharingInfo:s.SharingInformation}];throw $(u)}}))}))}));function rt(t,e,n,r,a,i){return Object(m.__awaiter)(this,void 0,void 0,(function(){var o;return Object(m.__generator)(this,(function(c){switch(c.label){case 0:return o=Object(B.a)(t.mailboxInfo)||{},[4,(s={itemId:t,uri:e,name:n,subscriptionId:r,isInline:a,contentId:i},u=o,void 0===s.itemId||s.itemId.__type||(s.itemId=Object(N.a)(s.itemId)),Object(x.a)("CreateAttachmentFromUri",s,u))];case 1:return[2,c.sent()]}var s,u}))}))}var at=Object(v.action)("createAttachmentFromUri")((function(t,e,n,r,a,i,o,c,u){var l=this,d=new s.b("AttachmentCreationFromUri");d.addCustomData({size:a?a.size:0});var h=function(t){o(t),d.end()},f=function(t){c(),d.endWithError("ServerError",t)};P((function(e,r,o,s){return Object(m.__awaiter)(l,void 0,void 0,(function(){return Object(m.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),0===i.attachmentType&&Object(p.B)(Object(p.l)(a.size),.05,(function(t){Object(p.x)(i,t)}),i.attachmentId),[4,rt(t,a.uri,a.name,e,n.IsInline,null)];case 1:if(!o.sent())throw new Error("Empty response for createAttachmentFromUriProvider request");return[3,3];case 2:return o.sent(),Object(p.C)(i.attachmentId,!1),c(),k(i,u.attachmentWellViewState,r,s),[3,3];case 3:return[2]}}))}))}),(function(r){T(r,t,e,n,i,h,f,u)}))})),it=n(8706);function ot(t,e,n){return Object(m.__awaiter)(this,void 0,void 0,(function(){var r;return Object(m.__generator)(this,(function(a){switch(a.label){case 0:return r=Object(B.a)(t.mailboxInfo)||{},[4,Object(it.a)({itemId:t,attachmentDataProviderId:n.providerId,location:n.location,attachmentId:n.fileId||"",dataProviderParentItemId:n.fileParentId||"",providerEndpointUrl:n.providerEndpointUrl,cancellationId:e,thumbnailUrl:n.thumbnailUrl,previewUrl:n.previewUrl,isFolder:n.isFolder,mimeType:n.type},r)];case 1:return[2,a.sent()]}}))}))}var ct=n(7123),st=Object(Z.d)("createReferenceAttachmentFromAttachmentDataProvider",L.a.AttachmentCreationCloudyFromAttachmentDataProvider)((function(t,e,n,r){return Object(m.__awaiter)(this,void 0,void 0,(function(){var i=this;return Object(m.__generator)(this,(function(o){return 0===r.attachmentType&&Object(p.B)(4e3,.05,(function(t){Object(p.x)(r,t)}),r.attachmentId),[2,ot(t,e,n).then((function(t){return Object(m.__awaiter)(i,void 0,void 0,(function(){var e,n;return Object(m.__generator)(this,(function(i){switch(i.label){case 0:return(e=t.ResponseMessages.Items.length>0?t.ResponseMessages.Items[0]:null)&&e.Attachments.length>0?(Object(p.C)(r.attachmentId,!0),[2,{attachment:e.Attachments[0],sharingInfo:t.SharingInformation}]):[3,1];case 1:return Object(p.C)(r.attachmentId,!1),Object(K.i)("doc-authContext")?!t.SharingInformation||Object(a.f)(t.SharingInformation.ClaimsChallenge)?[3,4]:(n=t.SharingInformation.ClaimsChallenge,[4,ct.a.import()]):[3,4];case 2:return[4,i.sent()(n)];case 3:throw i.sent(),$(e,t.SharingInformation.ResultCode.toString());case 4:throw $(e)}}))}))}))]}))}))}));var ut=H("/service.svc/CreateReferenceAttachmentFromLocalFile");function lt(t,e,n,r,a,i,o,c,s,u){return Object(m.__awaiter)(this,void 0,void 0,(function(){var l;return Object(m.__generator)(this,(function(d){switch(d.label){case 0:return h={ParentItemId:t,FileName:e.Name,SubscriptionId:a,ChannelId:i,FileSizeInBytes:e.Size,SliceNumber:o,TotalSlices:c,CancellationId:n,FileContentToUpload:"",GroupSmtpAddress:s,UploadFolderId:u},l=Object(m.__assign)({__type:"CreateReferenceAttachmentFromLocalFileRequest:#Exchange"},h),[4,M(ut,{requestObject:l},"CreateReferenceAttachmentFromLocalFile",t.mailboxInfo,r,void 0)];case 1:return[2,d.sent()]}var h}))}))}var dt=n(3389),mt=Object(Z.d)("createReferenceAttachmentFromLocalFile",L.a.AttachmentCreationCloudyFromLocalFile)((function(t,e,n,r,a,i,o,c,s){return Object(m.__awaiter)(this,void 0,void 0,(function(){var u=this;return Object(m.__generator)(this,(function(l){return P((function(e,o,l,d){return Object(m.__awaiter)(u,void 0,void 0,(function(){return Object(m.__generator)(this,(function(u){return function(t,e,n,r,a,i,o,c,s,u,l,d){var h;Object(m.__awaiter)(this,void 0,void 0,(function(){var f,b,I,v,g,O,A,j;return Object(m.__generator)(this,(function(m){switch(m.label){case 0:return f=Math.ceil(r.size/u),Object(p.B)(Object(p.q)(r.size),.05,(function(t){Object(p.x)(a,t)}),a.attachmentId),b=null,(I=null===(h=null==d?void 0:d.attachmentWellViewState)||void 0===h?void 0:h.groupId)?(b=Object(dt.c)(I)?Object(dt.c)(I).folderId:null)?[3,2]:[4,Object(dt.b)(I,dt.a.Group)]:[3,2];case 1:(j=m.sent())&&(b=j.folderId),m.label=2;case 2:v=0,m.label=3;case 3:if(!(v<f))return[3,8];g=0+v*u,O=Math.min(g+u,r.size),A=r.slice(g,O),m.label=4;case 4:return m.trys.push([4,6,,7]),[4,lt(t,e,n,A,i,c,v,f,I,b)];case 5:if(!(j=m.sent()))throw new Error("Empty response for createReferenceAttachmentFromLocalFile request");return[3,7];case 6:return m.sent(),Object(p.C)(a.attachmentId,!1),l(),k(a,d.attachmentWellViewState,o,s),[2];case 7:return v++,[3,3];case 8:return[2]}}))}))}(t,n,r,a,i,e,o,l,d,10485760,c,s),[2]}))}))}),(function(r){T(r,t,e,n,i,o,c,s)})),[2]}))}))}));var ht=n(1434),ft=n(4887),bt=n(311),pt=n(8707);function It(t,e,n,r,a,i,o,c){var u=this,l=new s.b("UploadLocalFileAndCreateCloudyAttachment",{timeout:3e5}),d=Object(m.__read)(Object(pt.a)(n.Name,i,a,(function(t){var e=t.loaded/t.total;Object(p.x)(o,e)})),2),h=d[0],f=h.uploadPromise,b=h.cancel,I=d[1].model,v=I.Id,g=I.EndPointUrl,O=I.Type,A=!1;return{onCompletePromise:Object(m.__awaiter)(u,void 0,void 0,(function(){var a,i,u,d,h,b,I,j,C,_;return Object(m.__generator)(this,(function(m){switch(m.label){case 0:a=null,m.label=1;case 1:return m.trys.push([1,6,7,8]),[4,f];case 2:return i=m.sent(),u=i.errorResponse,d=i.result,u?[4,u.text()]:[3,4];case 3:throw h=m.sent(),new Error("Unable to upload file with status code: "+u.status+"; response: "+h);case 4:return b=function(t,e,n,r){return{fileType:ht.a.Cloud,name:t.name,size:t.size,providerId:e,providerType:n,location:vt(t,n),providerEndpointUrl:r,isFolder:!1,fileId:t.id,fileParentId:t.parentReference.id,thumbnailUrl:"",previewUrl:"",type:Object(ft.c)(t)}}(d,v,O,g),[4,ot(t,r,b)];case 5:if(I=m.sent(),(j=I.ResponseMessages.Items[0])&&j.Attachments.length>0)return Object(p.C)(o.attachmentId,!0),C=j.Attachments[0],S(o,e,n,C,t,I.SharingInformation,c.attachmentWellViewState),[2,C];throw new Error(j.MessageText);case 6:if(_=m.sent(),Object(p.C)(o.attachmentId,!1),k(o,c.attachmentWellViewState),A)return[2,null];throw a=_,_;case 7:return a?(new s.b("UploadLocalFileAndCreateCloudyAttachmentError",{isCore:!0}).endWithError(a),l.endWithError(a)):l.end(),[7];case 8:return[2]}}))})),cancel:function(){A=!0,b()}}}function vt(t,e){return 1===e?t.parentReference.path+"/"+t.name:Object(bt.parse)(t.webUrl).path}var gt=n(11082),Ot=14680064;function At(t,e,n,r){t.addCustomData([e]),n?t.end():t.endWithError("ServerError",r)}function jt(t,e,n,r,a,i){void 0===i&&(i={}),i.sliceSizeInBytes=i.sliceSizeInBytes||Ot;var o=new s.b("AttachmentCreationClassicFromLocalFileSliced",{timeout:3e5}),c=function(t,e,n,r,a){var i=this,o=null,c=!1,s=null;return{action:function(u,l,d){return Object(m.__awaiter)(i,void 0,void 0,(function(){var i,h,f;return Object(m.__generator)(this,(function(b){switch(b.label){case 0:return s||(s=function(t){for(var e=[],n=0;n<t;n++)e[n]=0;return e}(d)),i=null,0===a.attachmentType&&(i=function(t){s[l]=t.loaded;var e=s.reduce((function(t,e){return t+e}),0)/r.size;Object(p.x)(a,e)}),h=Y(e),[4,X(t,h,n,u,i,{sliceNumber:l,totalSlices:d})];case 1:if(f=b.sent(),!function(t){return t&&t.Attachments.length>0&&t.Attachments[0]}(o=f.ResponseMessages.Items[0]))throw $(o);return c||(e=Object(m.__assign)(Object(m.__assign)({},e),{AttachmentId:o.Attachments[0].AttachmentId}),c=!0),[2]}}))}))},getLastResponseMessage:function(){return o}}}(t,e,n,r,a),l=c.action,d=c.getLastResponseMessage,h=Object(gt.a)(r,l,{sliceSize:i.sliceSizeInBytes,numberOfSlicesToParallelize:1}),f=h.onCompletePromise,b=h.cancel,I=!1;return{onCompletePromise:f.then((function(t){switch(t){case 0:return At(o,r.size,!0),{status:0,attachment:d().Attachments[0]};case 1:return{status:1};default:return Object(u.a)(t)}})).catch((function(t){if(I)return{status:1};throw At(o,r.size,!1,t),t})),cancel:function(){I=!0,b()}}}function Ct(t,e,n,r,a,i,o){void 0===o&&(o={shouldShare:!1});var c,s=r&&(r.fileType===ht.a.Cloud||r.fileType===ht.a.CloudSuggestion||r.fileType===ht.a.ContextualSuggestion),l=null,d=Object(m.__assign)(Object(m.__assign)({},e.AttachmentId),{mailboxInfo:t.mailboxInfo}),h=o.shouldShare,f=function(){};if((c=r).fileType===ht.a.AttachmentItem||c.fileType===ht.a.AttachmentItemSuggestion||(c.fileType===ht.a.Cloud||c.fileType===ht.a.CloudSuggestion||c.fileType===ht.a.ContextualSuggestion)&&4===c.providerType)l=nt(t,e,n,r,a,s).then((function(t){return t}));else if(h||s){if(!h&&s)return{createAttachmentPromise:new Promise((function(o,c){D(t,d,e,n,r,a,o,c,i)})),cancelCreateAttachment:f};if(!h||!s){if(o.shouldShare&&o.shareProperties&&!o.shareProperties.groupMailboxId){var b=It(t,d,e,n,o.shareProperties.folderInfo,r.fileObject,a,i);return{createAttachmentPromise:I=b.onCompletePromise,cancelCreateAttachment:b.cancel}}return{createAttachmentPromise:new Promise((function(o,c){return mt(t,d,e,n,r.fileObject,a,o,c,i),e})),cancelCreateAttachment:f}}l=st(t,n,r,a)}else if(r&&r.fileType===ht.a.Local&&r.fileObject){var p=jt(t,e,n,r.fileObject,a),I=p.onCompletePromise;f=p.cancel,l=I.then((function(t){switch(t.status){case 0:return{attachment:t.attachment,sharingInfo:null};case 1:return null;default:return Object(u.a)(t)}}))}else{if(r&&r.fileType===ht.a.Uri)return{createAttachmentPromise:new Promise((function(o,c){at(t,d,e,n,r,a,o,c,i)})),cancelCreateAttachment:f};l=tt(t,e,n,r&&r.fileType===ht.a.Local?r.fileObject:null,a)}return function(t,e,n,r,a,i,o){return{createAttachmentPromise:i.then((function(i){return i?(S(r,e,n,i.attachment,t,i.sharingInfo,a.attachmentWellViewState),i.attachment):null})).catch((function(t){throw k(r,a.attachmentWellViewState,null,null),t})),cancelCreateAttachment:o}}(t,d,e,a,i,l,f)}var _t=n(7691),yt=Object(Z.d)("deleteAttachment",L.a.AttachmentDeletionAction)((function(t,e,n,r){return Object(_t.a)(e.attachmentId).then((function(r){var a=r.ResponseMessages.Items[0];"Success"===a.ResponseClass?(Object(C.a)(t,e),Object(y.a)(n,a.RootItemId.RootItemChangeKey)):I.g.warn("Attachment: Failed to delete attachment with ResponseClass= "+a.ResponseClass+", ResponseCode="+a.ResponseCode)})).catch((function(t){throw I.g.warn("Attachment: deleteAttachment got error: "+t.message),t}))}));function wt(t){return e={cancellationId:t},Object(x.a)("CancelAttachment",e,n);var e,n}var St=n(1905);function kt(t){if(null==t)return null;switch(t){case 0:return St.i;case 5:return St.e;case 1:return St.h;case 2:return St.c;case 3:return St.b;case 7:return St.j;case 9:return St.k;case 8:return St.l;case 4:return St.f;case 6:return St.d;case 10:return St.g;default:return Object(u.a)(t)}}var Tt=n(4413),Ft=n(5227),Pt=n(8708),xt=n(8709),Nt=n(6489),Bt=n(7221),Et=n(1629);function Rt(t,e){var n=Object(l.a)(t.item.attachmentId);if(n){!function(t,e,n){Object(Et.a)(n,t,[e])}("WarningAttachmentsCanNotBeDeleted",Object(a.c)(Object(a.b)(Bt.a),n.model.Name),e)}}var Dt=n(13567),Lt=n(1385),Ut=4;function Mt(t,e,n){Object(Et.a)(n,t,[e])}function Wt(t,e){var n,r=(n=function(t){return t.reason},t.reduce((function(t,e){var r=n(e);return t[r]?t[r].push(e):t[r]=[e],t}),{}));Object.keys(r).forEach((function(t){var n=r[t];switch(parseInt(t)){case 0:!function(t,e){var n=null,r=null;if(1===t.length&&null!==t[0].item.tryAgainCallback){var i=t[0],o=i.item.file.name,c=Object(a.c)(Object(a.b)(Dt.e),o),s={key:"WarningFilesCanNotBeAttachedWithNamesGenericError",source:Lt.c.Compose,rank:Lt.b.Info,message:c,messageParts:[c]},u={text:Object(a.b)(Dt.a),action:function(){return i.item.tryAgainCallback()}};return s.messageParts.push(u),void Object(Et.a)(e,"WarningFilesCanNotBeAttachedWithNamesGenericError",(function(t){return s}))}if(t.length<Ut){var l=t.map((function(t){return t.item.file.name})).join(", ");r="WarningFilesCanNotBeAttachedWithNamesGenericError",n=Object(a.c)(Object(a.b)(Dt.b),l)}else r="WarningSeveralFilesCanNotBeAttachedGenericError",n=Object(a.c)(Object(a.b)(Dt.d),t.length);Mt(r,n,e)}(n,e);break;case 1:!function(t,e){Mt("WarningFilesCannotBeAttachedFromOtherMailboxes",Object(a.b)(Dt.c),e)}(0,e);break;case 2:!function(t,e){Mt("WarningSpecialCharactersAreNotSupported",Object(a.b)(Dt.f),e)}(0,e)}}))}var Ht=function(){function t(t,e,n,r,a){var i=this;void 0===r&&(r=null),void 0===a&&(a=null),this.attachmentWellViewState=t,this.parentItemId=e,this.infoBar=n,this.onAnyAttachmentCreatedInParentItemCallback=r,this.onAnyAttachmentDeletedInParentItemCallback=a,this.uploadQueue=[],this.deleteQueue=[],this.uploadFailures=[],this.onFinishPromise=new Promise((function(t,e){i.onFinish=function(e){t(e)}}))}return t.prototype.enqueueAttachmentCreation=function(t,e,n,r,a){void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null);var i=e.isInline,o=e.shouldShare,s=e.isHiddenInline,u=e.skipProcessInlineImage;if(Object(c.a)(this.infoBar),!o&&Object(f.a)(t,this.infoBar,this.attachmentWellViewState))return[];t=Object(h.a)(t,i,this.infoBar);for(var l=0,d=void 0;d=t[l];l++){var v=void 0,g=null,O={Name:null,ContentType:null,ContentId:null,ContentLocation:null,AttachmentOriginalUrl:null,Size:0,LastModifiedTime:null,IsInline:!1,IsInlineToUniqueBody:!1,IsInlineToNormalBody:!1,ThumbnailMimeType:null,Thumbnail:null};if(o){var A=d;v=Object(Nt.a)(Object(m.__assign)(Object(m.__assign)({},O),{Name:A.name,Size:A.size,ContentType:A.type,ProviderType:kt(A.providerType),AttachmentIsFolder:A.isFolder,IsInline:!1,PermissionType:0,AttachLongPathName:null,ProviderEndpointUrl:null,AttachmentThumbnailUrl:null,AttachmentPreviewUrl:null,OriginalPermissionType:0}))}else if(d.fileType===ht.a.Base64InlineImage||d.fileType===ht.a.ExpirableBase64InlineImage){var j=d;v=Object(Tt.a)(Object(m.__assign)(Object(m.__assign)({},O),{Name:j.name,Size:j.size,ContentType:j.type,IsInline:!0,Content:j.dataUri,IsContactPhoto:!1,ImageThumbnailSalientRegions:null,ImageThumbnailHeight:0,ImageThumbnailWidth:0})),g=j.tempId}else if(d.fileType===ht.a.MailItem){var C=d;if(C.mimeContent)v=Object(Pt.a)(Object(m.__assign)(Object(m.__assign)({},O),{Name:d.name,Size:d.size,IsInline:!1,Item:Object(Ft.a)({MimeContent:Object(xt.a)({Value:C.mimeContent})}),ContentType:"message/rfc822"}));else{var _=Object(N.a)({Id:C.itemId});v=Object(et.a)(Object(m.__assign)(Object(m.__assign)({},O),{Name:d.name,IsInline:!1,ItemId:_,Size:d.size,AttachmentIdToAttach:null,CreateAttachmentInlineType:0}))}}else if(d.fileType===ht.a.AttachmentItem||d.fileType===ht.a.AttachmentItemSuggestion){var y=d;v=Object(et.a)(Object(m.__assign)(Object(m.__assign)({},O),{Name:y.name,AttachmentIdToAttach:y.attachmentItemId,__type:y.type,Size:d.size,ItemId:null,CreateAttachmentInlineType:0}))}else d.fileType===ht.a.Uri?v=Object(Tt.a)(Object(m.__assign)(Object(m.__assign)({},O),{Name:d.name,AttachmentOriginalUrl:d.uri,Size:d.size,ContentType:d.type,IsInline:i,Content:"",IsContactPhoto:!1,ImageThumbnailSalientRegions:null,ImageThumbnailHeight:0,ImageThumbnailWidth:0})):(v=Object(Tt.a)(Object(m.__assign)(Object(m.__assign)({},O),{Name:d.name,Size:d.size,ContentType:d.type,IsInline:i,Content:"",IsContactPhoto:!1,ImageThumbnailSalientRegions:null,ImageThumbnailHeight:0,ImageThumbnailWidth:0})),g=d.tempId);var w={Id:g||Object(F.a)(),mailboxInfo:this.parentItemId.mailboxInfo},S=void 0;i?S=Object(p.i)(w,w.Id,s,0,u):(S=Object(p.g)(w,!1,!1,o,d.fileType,!0),e.isAddedFromSmartDoc&&(S.fileType=ht.a.SmartDoc),this.attachmentWellViewState.supportedMenuActions&&(S.strategy.supportedMenuActions=this.attachmentWellViewState.supportedMenuActions),e.downsellFromLink&&Object(p.A)(S,6,11)),Object(b.a)(S,this.attachmentWellViewState,v,w);var k={attachmentState:S,file:d,attachment:v,shouldShareInfo:e,cancelPendingUpload:function(){},onAttachmentCreatedCallback:n,onAttachmentCanceledOrFailedCallback:r,tryAgainCallback:a};I.g.info("Attachment: UploadQueue enqueue attachment: Name="+d.name),this.uploadQueue.push(k)}return this.startProcessIfNotStarted(),t},t.prototype.deleteAttachment=function(t,e){var n=this;void 0===e&&(e=null),Object(c.a)(this.infoBar);var r=1===t.attachmentType,a=r?0===t.status:t.actionCompletePercent<=1;if(r||Object(p.A)(t,3,a?10:6),a&&this.currentUploadItem)if(this.currentUploadItem.attachmentState.attachmentId===t.attachmentId){I.g.info("Attachment: Cancelling attachment: TempId="+t.attachmentId);var i=this.currentUploadItem;if(i.cancelPendingUpload(),0===t.attachmentType&&t.isCloudy){if(I.g.info("Attachment: Put attachment: Id= "+t.attachmentId+" into deleteQueue"),0===this.deleteQueue.filter((function(e){return e.attachmentState.attachmentId===t.attachmentId})).length){var o={attachmentState:t,onAttachmentDeletedCallback:e};this.deleteQueue.push(o)}this.startProcessIfNotStarted()}else this.isCancelling||(this.isCancelling=!0,wt(t.attachmentId.Id).then((function(e){n.isCancelling=!1,e?(Object(C.a)(n.attachmentWellViewState,t),i.onAttachmentCanceledOrFailedCallback&&i.onAttachmentCanceledOrFailedCallback(!0)):n.onAttachmentDeleteFailure(t)})))}else I.g.info("Attachment: Removing attachment: TempId= "+t.attachmentId+" from queue"),function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.attachmentState.attachmentId===t.attachmentId&&(r.onAttachmentCanceledOrFailedCallback&&r.onAttachmentCanceledOrFailedCallback(!0),e.splice(n,1))}}(t,this.uploadQueue),Object(C.a)(this.attachmentWellViewState,t);else{if(I.g.info("Attachment: Put attachment: Id= "+t.attachmentId+" into deleteQueue"),0===this.deleteQueue.filter((function(e){return e.attachmentState.attachmentId===t.attachmentId})).length){o={attachmentState:t,onAttachmentDeletedCallback:e};this.deleteQueue.push(o)}this.startProcessIfNotStarted()}},t.prototype.onAttachmentDeleteFailure=function(t){var e,n;e={item:t,reason:0},n=this.infoBar,Object(c.a)(n),Rt(e,n),1!==t.attachmentType&&Object(p.A)(t,0,0),I.g.warn("Attachment: Failed to cancel attachment: TempId="+t.attachmentId)},t.prototype.startProcessIfNotStarted=function(){this.isInProgress||(this.datapoint=new s.b("AttachmentQueueManager"),this.isInProgress=!0,this.processNextAttachment("NewProcess"))},t.prototype.processNextAttachment=function(t){var e=this;if(I.g.info("Attachment: Invoking processNextAttachment from: "+t),0!==this.deleteQueue.length){var n=this.deleteQueue[0],r=n.attachmentState,a=n.onAttachmentDeletedCallback,i=Object(l.a)(r.attachmentId);I.g.info("Attachment: Deleting attachment: Id= "+r.attachmentId),yt(this.attachmentWellViewState,r,this.parentItemId,r.fileType).then((function(){e.deleteQueue.shift(),zt(a,e.parentItemId,r.attachmentId,i.model),zt(e.onAnyAttachmentDeletedInParentItemCallback,e.parentItemId,r.attachmentId,i.model),e.processNextAttachment("DeleteAttachmentFinish")})).catch((function(t){e.deleteQueue.shift(),e.onAttachmentDeleteFailure(r),e.logDeletionFailure(t.message,r),e.processNextAttachment("DeleteAttachmentFinish")}))}else if(0!==this.uploadQueue.length){this.currentUploadItem=this.uploadQueue.shift();var o=this.currentUploadItem.onAttachmentCreatedCallback,c={attachmentWellViewState:this.attachmentWellViewState,parentItemId:this.parentItemId,infoBar:this.infoBar},s=Ct(this.parentItemId,this.currentUploadItem.attachment,this.currentUploadItem.attachmentState.attachmentId.Id,this.currentUploadItem.file,this.currentUploadItem.attachmentState,c,this.currentUploadItem.shouldShareInfo),u=s.createAttachmentPromise,d=s.cancelCreateAttachment;this.currentUploadItem.cancelPendingUpload=d,u.then((function(t){if(t){var n=Object(m.__assign)(Object(m.__assign)({},t.AttachmentId),{mailboxInfo:e.parentItemId.mailboxInfo});zt(o,e.parentItemId,n,t),zt(e.onAnyAttachmentCreatedInParentItemCallback,e.parentItemId,n,t)}e.processNextAttachment("CreateAttachmentFinish")})).catch((function(t){var n=0;(null==t?void 0:t.message)===R.c&&(n=2),t&&"ErrorNonExistentMailbox"===t.errorCode&&(n=1),e.uploadFailures.push({item:e.currentUploadItem,reason:n}),e.currentUploadItem.onAttachmentCanceledOrFailedCallback&&e.currentUploadItem.onAttachmentCanceledOrFailedCallback(!1),e.logCreationFailure(),e.processNextAttachment("CreateAttachmentFinish")}))}else this.finishProcess()},t.prototype.finishProcess=function(){I.g.info("Attachment: AttachmentQueueManager: finishProcess"),this.isInProgress=!1;var t=this.currentUploadItem&&this.currentUploadItem.attachmentState?this.currentUploadItem.attachmentState.attachmentId:null;this.currentUploadItem=null,this.onFinish(t),this.datapoint.end(),this.datapoint=null,Wt(this.uploadFailures,this.infoBar),this.uploadFailures=[]},t.prototype.logCreationFailure=function(){Object(s.q)("AttachmentCreationFailure")},t.prototype.logDeletionFailure=function(t,e){Object(s.q)("AttachmentDeletionFailure",[t],{cosmosOnlyData:JSON.stringify({attachmentId:e.attachmentId.Id})})},t}();function zt(t,e,n,r){t&&t(e,n,r)}n.d(e,"a",(function(){return qt})),n.d(e,"b",(function(){return Gt}));var Vt={};function qt(t,e,n,i,o,u,l,m,h){if(void 0===o&&(o={isInline:!1,isHiddenInline:!1,shouldShare:!1,skipProcessInlineImage:!1}),!e)return Object(c.a)(i),Object(Et.a)(i,"WarningFilesCanNotBeAttachedGenericError",[Object(a.b)(r.a)]),[];var f=Qt(t,e,i,u);return function(t,e,n){for(var r=0;r<t.length;r++){var a=t[r];Object(s.q)("AttachmentCreation",[e,n],{cosmosOnlyData:JSON.stringify({fileType:a.fileType,size:a.size,ext:Object(d.d)(a.name)||""})})}}(n,o.isInline,o.shouldShare),f.enqueueAttachmentCreation(n,o,l,m,h)}function Gt(t,e,n,r,a){var i=Qt(t,n,r);!function(t){var e=t.attachmentType;switch(e){case 1:Object(s.q)("AttachmentDeletion",[!0,!1,0]);break;case 0:var n=Object(l.a)(t.attachmentId);Object(s.q)("AttachmentDeletion",[!1,t.isCloudy],{cosmosOnlyData:JSON.stringify({size:n.model.Size})});break;default:Object(u.a)(e)}}(e),i.deleteAttachment(e,a)}function Qt(t,e,n,r){var a=Vt[e.Id];return a||(a=function(t,e,n,r,a){return void 0===r&&(r=null),void 0===a&&(a=null),new Ht(t,e,n,r,a)}(t,e,n,i.a,o.a),Vt[e.Id]=a,a.onFinishPromise.then((function(t){delete Vt[e.Id],r&&r(t)}))),a}},7691:function(t,e,n){"use strict";var r=n(0),a=n(443);var i=n(4535),o=n(317);function c(t){return e={ClientSupportsIrm:!0,AttachmentIds:[t]},Object(r.__assign)({__type:"DeleteAttachmentRequest:#Exchange"},e);var e}function s(t,e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,s,u;return Object(r.__generator)(this,(function(l){switch(l.label){case 0:return n=c(t),s=Object(a.a)(t.mailboxInfo)||{},u=Object(r.__assign)(Object(r.__assign)({},s),e||{}),[4,Object(i.a)({Header:Object(o.b)(),Body:n},u)];case 1:return[2,l.sent().Body]}}))}))}n.d(e,"a",(function(){return s}))},8703:function(t,e,n){"use strict";var r=n(0),a=n(5606),i=n(3724),o=n(4411),c=n(281),s=n(1752);e.a=Object(c.action)("addAttachmentIntoWellBeforeUpload")((function(t,e,n,c,u){var l;void 0===u&&(u=null),n.AttachmentId=c,Object(i.a)([{attachmentId:Object(r.__assign)(Object(r.__assign)({},n.AttachmentId),{mailboxInfo:c.mailboxInfo}),attachment:n,modelInitializationValues:u}],!1,!0,!0),Object(s.s)(t)?(e.inlineAttachments.push(t),l=!0):(t.isPlaceholderAttachment=!0,Object(o.a)(n)?e.imageViewAttachments.push(t):e.docViewAttachments.push(t)),!l&&t.isCloudy||Object(a.a)(e,n.Size,n.AttachmentId)}))},8706:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(29),a=n(728);function i(t,e){return void 0===t.itemId||t.itemId.__type||(t.itemId=Object(a.a)(t.itemId)),Object(r.a)("CreateReferenceAttachmentFromAttachmentDataProvider",t,e)}},8707:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(0),a=n(267),i=n(2733),o=n(1547),c=n(318);function s(t,e,n,a){var s=Object(c.a)()?1:0,l=Object(o.h)(),d=Object(r.__read)(l.filter((function(t){return t.type===s})),1)[0];if(!d)throw new Error("Unable to upload file as couldnt find OneDrive provider");var m=d.model.EndPointUrl,h={fileToUpload:{fileName:t,fileBlob:e},conflictBehavior:"rename",folderInfo:u(n),onProgress:a};return[1===s?Object(i.v)(1,i.e,h):Object(i.v)(0,m,h),d]}function u(t){var e=t.identifierType,n=t.identifier;switch(e){case 0:return{type:0,identifier:n};case 1:return{type:1,identifier:n};default:return Object(a.a)(e)}}}}]);
//# sourceMappingURL=owa.MailBoot~Attachments~filesView.js.map
self.scriptsLoaded['owa.MailBoot~Attachments~filesView.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~Attachments~filesView.js'] = (new Date()).getTime();