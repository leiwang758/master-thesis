self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~MailFavoritesStore~MailFolderView.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[254],{10253:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(0),a=r(1556),o=r(1536),s=r(317),i=r(1364),c=r(760);function d(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(t){return[2,Object(o.a)(Object(a.a)({Header:Object(s.b)(),Body:{PersonaId:{Id:e},ParentFolderId:Object(i.a)({BaseFolderId:Object(c.a)({Id:"mycontacts"})})}})).then((function(e){if("Success"===e.Body.ResponseClass||"ErrorItemNotFound"===e.Body.ResponseCode)return e.Body.Persona;throw new Error("GetPersona failed ("+e.Body.ResponseCode+" "+e.Body.MessageText+")")}))]}))}))}},10254:function(e,t,r){"use strict";var n=r(0),a=r(1318),o=r(5796),s=r(1291),i=r(281),c=r(2344),d=r(290);t.a=Object(i.action)("setupFavoritePersona")((function(e){var t=Object(o.d)(e),r=Object(a.getStore)().favoritesPersonaNodes.get(t);if(r){var i=Object(n.__assign)(Object(n.__assign)({},Object(c.c)(e,Object(d.d)())),{DisplayName:r.displayName});s.d.folderTable.set(e.FolderId.Id,i);var u=i.FolderId.Id;r.searchFolderId!==u&&(r.searchFolderId=u)}}))},10255:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s}));var n=r(1318),a=r(281),o=3e4,s=Object(a.action)("markSearchFolderAsPopulated")((function(e){var t=Object(n.getStore)().favoritesPersonaNodes.get(e);t&&(t.isSearchFolderPopulated=!0)}))},11150:function(e,t,r){"use strict";var n=r(0),a=r(760),o=r(1821),s=r(2162),i=r(1479),c=r(2015),d=r(1364),u=r(2124),l=r(317),f=r(2268),b={BasePoint:"Beginning",Offset:0,MaxEntriesReturned:10},O={BaseShape:"Default"};function p(){return[Object(f.a)({Key:"AppName",Value:"OWA"})]}function j(e){return Object(s.a)({IndexedPageItemView:Object(i.a)(b),PersonaShape:Object(c.a)(O),QuerySources:["Mailbox","Directory"],QueryString:e,SearchPeopleSuggestionIndex:!0,ShouldResolveOneOffEmailAddress:!0,Context:p()})}function _(e){return Object(s.a)({IndexedPageItemView:Object(i.a)(b),PersonaShape:Object(c.a)(O),QuerySources:["Mailbox"],QueryString:e,ParentFolderId:Object(d.a)({BaseFolderId:Object(a.a)({Id:"mycontacts"})}),Context:p()})}function v(e,t){if("Success"==e.ResponseClass)return{personas:e.ResultSet,requestId:e.TransactionId};throw new Error("FindPeople failed ("+e.ResponseCode+" "+e.MessageText+" "+t+")")}function g(e){return Object(u.a)(Object(o.a)({Header:Object(l.b)(),Body:_(e)})).then((function(e){return v(e.Body,!0)}))}var h=r(56),F=r(266),y=r(2364);function I(e,t,r){return r?function(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,a,s,i,c,d;return Object(n.__generator)(this,(function(f){switch(f.label){case 0:return b=e,r=Object(u.a)(Object(o.a)({Header:Object(l.b)(),Body:j(b)})).then((function(e){return v(e.Body,!1)})),[4,g(e)];case 1:return(a=f.sent()).personas&&a.personas.length>0?(i=a,[3,4]):[3,2];case 2:return[4,r];case 3:i=f.sent(),f.label=4;case 4:if((s=i).personas&&s.personas.length>0)return(c=s.personas.filter((function(e){return e.DisplayName&&t&&e.DisplayName.toLocaleLowerCase()===t.toLocaleLowerCase()}))).length>0?[2,c[0]]:(d=s.personas[0]).DisplayName===e&&"OneOff"===d.EmailAddress.MailboxType?(Object(F.q)(y.a.OneOffAddressUsedForFavorite),[2,Object(n.__assign)(Object(n.__assign)({},d),{DisplayName:t})]):[2,d];throw h.g.warn("Cannot find persona by email: "+e),new Error("Persona not found (people: "+s.requestId+", contacts: "+a.requestId+", length: "+(e?e.length:"no email address")+")")}var b}))}))}(e,t):function(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,a;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return[4,g(e)];case 1:return(r=n.sent()).personas&&r.personas.length>0?(a=r.personas.filter((function(e){return e.DisplayName&&t&&e.DisplayName.toLocaleLowerCase()===t.toLocaleLowerCase()}))).length>0?[2,a[0]]:[2,r.personas[0]]:[2,null]}}))}))}(e,t)}r.d(t,"a",(function(){return I}))},1536:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(29),a=r(1556);function o(e,t){return void 0===e||e.__type||(e=Object(a.a)(e)),Object(n.a)("GetPersona",e,t)}},1556:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"GetPersonaJsonRequest:#Exchange"},e)}},1653:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"ExtendedPropertyType:#Exchange"},e)}},1821:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"FindPeopleJsonRequest:#Exchange"},e)}},1924:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"Constant:#Exchange"},e)}},1925:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"FieldURIOrConstantType:#Exchange"},e)}},1926:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"RestrictionType:#Exchange"},e)}},2015:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"PersonaResponseShape:#Exchange"},e)}},2124:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(29),a=r(1821);function o(e,t){return void 0===e||e.__type||(e=Object(a.a)(e)),Object(n.a)("FindPeople",e,t)}},2162:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"FindPeopleRequest:#Exchange"},e)}},2268:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"ContextProperty:#Exchange"},e)}},2269:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"And:#Exchange"},e)}},2499:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"FolderResponseShape:#Exchange"},e)}},2619:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"GetFolderRequest:#Exchange"},e)}},2662:function(e,t,r){"use strict";var n=r(29),a=r(0);function o(e,t){var r;return void 0===e||e.__type||(r=e,e=Object(a.__assign)({__type:"GetFolderJsonRequest:#Exchange"},r)),Object(n.a)("GetFolder",e,t)}r.d(t,"a",(function(){return o}))},2709:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"IsEqualTo:#Exchange"},e)}},3484:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"FindFolderRequest:#Exchange"},e)}},3519:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"Folder:#Exchange"},e)}},3578:function(e,t,r){"use strict";var n=r(29),a=r(0);function o(e,t){var r;return void 0===e||e.__type||(r=e,e=Object(a.__assign)({__type:"FindFolderJsonRequest:#Exchange"},r)),Object(n.a)("FindFolder",e,t)}r.d(t,"a",(function(){return o}))},3922:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"Or:#Exchange"},e)}},5633:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"DeleteFolderRequest:#Exchange"},e)}},5796:function(e,t,r){"use strict";var n=r(5633),a=r(554),o=r(5846),s=r(317);function i(e,t){return 0===e.length||0===e.filter((function(e){return void 0!==e})).length?Promise.resolve():Object(o.a)({Header:Object(s.b)(),Body:Object(n.a)({DeleteType:t?"SoftDelete":"MoveToDeletedItems",FolderIds:e.filter((function(e){return void 0!==e})).map((function(e){return Object(a.a)({Id:e})}))})}).then((function(e){var t=e.Body.ResponseMessages.Items[0];return"Success"==t.ResponseClass?Promise.resolve():Promise.reject("Delete folder failed: "+t.ResponseClass)}))}var c=r(474),d=r(2499),u=r(2619),l=r(1308),f=r(2662),b="PersonaId",O={PropertySetId:"{544b025e-cb61-4562-b021-16f4dcb2a7ac}",PropertyName:"Query",PropertyType:"String"},p={PropertySetId:"{1ffa50b8-9483-48df-ab40-de558669a5dc}",PropertyName:b,PropertyType:"String"};function j(){return Object(d.a)({BaseShape:"IdOnly",AdditionalProperties:[Object(l.a)({FieldURI:"UnreadCount"}),Object(l.a)({FieldURI:"TotalCount"}),Object(l.a)({FieldURI:"FolderDisplayName"}),Object(l.a)({FieldURI:"ParentFolderId"}),Object(c.a)(O),Object(c.a)(p)]})}function _(e){return Object(f.a)({Header:Object(s.b)(),Body:Object(u.a)({FolderShape:j(),FolderIds:e.map((function(e){return Object(a.a)({Id:e})}))})}).then((function(e){return e.Body.ResponseMessages.Items.filter((function(e){return"Success"===e.ResponseClass})).map((function(e){return e.Folders[0]}))}))}var v=r(1924),g=r(1925),h=r(3484),F=r(2709),y=r(3922),I=r(1926),m=r(3578);function P(e,t){var r=e.map((function(e){return function(e){return Object(F.a)({FieldURIOrConstant:Object(g.a)({Item:Object(v.a)({Value:e})}),Item:Object(c.a)(p)})}(e)}));return Object(h.a)({FolderShape:j(),Paging:null,ParentFolderIds:[Object(a.a)({Id:t})],ReturnParentFolder:!0,ShapeName:"Folder",Traversal:"Deep",Restriction:Object(I.a)({Item:Object(y.a)({Items:r})})})}function E(e,t){return Object(m.a)({Header:Object(s.b)(),Body:P(e,t)}).then((function(e){return"Success"===e.Body.ResponseMessages.Items[0].ResponseClass?Promise.resolve(e.Body.ResponseMessages.Items[0].RootFolder.Folders):Promise.reject(e.Body.ResponseMessages.Items[0].ResponseCode+": "+e.Body.ResponseMessages.Items[0].MessageText)}))}var w=r(0);function R(e){return function(e,t){var r=t.ExtendedProperty&&t.ExtendedProperty.filter((function(t){return t.ExtendedFieldURI&&t.ExtendedFieldURI.PropertyName===e}));if(r&&r.length>0)return r[0].Value}(b,e)}var x=r(2269),S=r(1301),N=r(6518),A=["deleteditems","conversationhistory","teamchat"];function C(e){var t=Object(y.a)({Items:e.map((function(e){return t=e,r="From",Object(F.a)({FieldURIOrConstant:Object(g.a)({Item:Object(v.a)({Value:t})}),Item:Object(l.a)({FieldURI:r})});var t,r}))}),r=Object(x.a)({Items:A.map((function(e){var t,r,n=Object(S.a)(e);return t=n,r="ParentFolderId",Object(N.a)({FieldURIOrConstant:Object(g.a)({Item:Object(v.a)({Value:t})}),Item:Object(l.a)({FieldURI:r})})}))}),n=Object(x.a)({Items:[t,r]});return Object(I.a)({Item:n})}var B=r(7261),T=r(7262),D=r(760),M=r(1653);function U(e){return Object(w.__assign)({__type:"SearchFolder:#Exchange"},e)}var q=r(7263),V=r(56),H="0x10f4",L=["msgfolderroot"];function J(e,t){return{ParentFolderId:{BaseFolderId:Object(a.a)({Id:e})},Folders:[U({DisplayName:t.displayName+"_"+t.favoriteNodeId,ExtendedProperty:(n=t.favoriteNodeId,o=L.join("_")+"_"+A.join("_")+"_v2",[Object(M.a)({ExtendedFieldURI:Object(c.a)(O),Value:o}),Object(M.a)({ExtendedFieldURI:Object(c.a)(p),Value:n}),Object(M.a)({ExtendedFieldURI:Object(c.a)({PropertyTag:H,PropertyType:"Boolean"}),Value:"true"})]),SearchParameters:(r={Restriction:C(t.allEmailAddresses),Traversal:"Deep",BaseFolderIds:L.map((function(e){return Object(D.a)({Id:e})}))},Object(w.__assign)({__type:"SearchParametersType:#Exchange"},r))})]};var r,n,o}function G(e){var t=e.ResponseMessages.Items[0];return new Promise((function(e,r){var n;"Success"==t.ResponseClass?e((n=t.Folders[0].FolderId.Id,Object(f.a)({Header:Object(s.b)(),Body:Object(u.a)({FolderShape:j(),FolderIds:[Object(a.a)({Id:n})]})}).then((function(e){return e.Body.ResponseMessages.Items[0].Folders[0]})))):"Error"===t.ResponseClass&&"ErrorFolderExists"===t.ResponseCode?(V.g.warn("Folder already exists"),r("ErrorFolderExists")):(V.g.warn("Error creating search folder "+t.MessageText),r(t.MessageText))}))}function Q(e,t){return Object(q.a)(Object(B.a)({Header:Object(s.b)(),Body:Object(T.a)(J(e,t))})).then((function(e){return G(e.Body)}))}var z=r(266),$=r(361),k="SynchronizePersonaSearchFolder";function K(e,t,r,n){return Object(w.__awaiter)(this,void 0,void 0,(function(){var a;return Object(w.__generator)(this,(function(o){switch(o.label){case 0:return[4,E([e.favoriteNodeId],t)];case 1:return a=o.sent(),[4,W(e,a,t,r,n)];case 2:return[2,o.sent()]}}))}))}function W(e,t,r,n,a){return Object(w.__awaiter)(this,void 0,void 0,(function(){var o,s,c;return Object(w.__generator)(this,(function(d){switch(d.label){case 0:o=function(e,t){var r=t.filter((function(t){return R(t)===e}));r.length>1&&V.d(r.length+" items were returned, one was expected");return 1===r.length&&r[0]}(e.favoriteNodeId,t),s=Object($.b)(e.favoriteNodeId)?e.favoriteNodeId:"",d.label=1;case 1:return d.trys.push([1,8,,9]),o?[3,3]:(Object(z.q)(k,["SearchFolderDoesNotExist",n,s]),[4,Q(r,e)]);case 2:return[2,d.sent()];case 3:return a?(Object(z.q)(k,["SearchFolderNeedsUpdate",n,s]),[4,i([o.FolderId.Id],!0)]):[3,6];case 4:return d.sent(),[4,Q(r,e)];case 5:return[2,d.sent()];case 6:return Object(z.q)(k,["SearchFolderExists",n,s]),[2,o];case 7:return[3,9];case 8:throw c=d.sent(),new Error("Error when creating/deleting search folder for persona: "+c+". Source: "+n);case 9:return[2]}}))}))}var X=r(3519),Y=r(1364);function Z(){return Object(m.a)({Header:Object(s.b)(),Body:Object(h.a)({FolderShape:j(),Paging:null,ParentFolderIds:[Object(D.a)({Id:"root"})],ReturnParentFolder:!0,ShapeName:"Folder",Traversal:"Deep",Restriction:Object(I.a)({Item:Object(F.a)({FieldURIOrConstant:Object(g.a)({Item:Object(v.a)({Value:"FavoritePersonas"})}),Item:Object(l.a)({FieldURI:"FolderDisplayName"})})})})}).then((function(e){var t=e.Body.ResponseMessages.Items[0].RootFolder.Folders;return new Promise((function(r,n){1===t.length?r(t[0]):t.length>1?(V.g.warn('More than one "FavoritePersonas" folder found.'),r(t[0])):0===t.length?r(void 0):(V.d(e.Body.ResponseMessages.Items[0].MessageText),n(e.Body.ResponseMessages.Items[0].MessageText))}))}))}var ee=r(72);function te(){return Object(w.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(w.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,6]),[4,Z()];case 1:return(t=r.sent())?(re(t),[2,t.FolderId.Id]):[4,Object(q.a)({Header:Object(s.b)(),Body:Object(T.a)({ParentFolderId:Object(Y.a)({BaseFolderId:Object(D.a)({Id:"root"})}),Folders:[Object(X.a)({DisplayName:"FavoritePersonas",FolderClass:"IPF.Note"})]})}).then((function(e){var t=e.Body.ResponseMessages.Items[0];if("Error"===t.ResponseClass&&"ErrorFolderExists"===t.ResponseCode)throw V.g.warn('Folder "FavoritePersonas" already exists'),new Error("ErrorFolderExists");if("Success"!==t.ResponseClass)throw V.d('Error creating "FavoritePersonas" '+t.MessageText),t.MessageText;return t.Folders[0].FolderId.Id}))];case 2:return[2,r.sent()];case 3:return"ErrorFolderExists"!==(e=r.sent())?[3,5]:[4,Z()];case 4:return re(t=r.sent()),[2,t.FolderId.Id];case 5:throw e;case 6:return[2]}}))}))}function re(e){if(null==e?void 0:e.ExtendedProperty){var t=e.ExtendedProperty.filter((function(e){var t;return(null===(t=e.ExtendedFieldURI)||void 0===t?void 0:t.PropertyTag)&&e.ExtendedFieldURI.PropertyTag.toLocaleLowerCase()===H})),r=t&&1===t.length?t[0].Value:"Property not found";Object(ee.h)("RootFavoritePersonaFolderLoaded",{isFolderHidden:r})}}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return _})),r.d(t,"e",(function(){return E})),r.d(t,"f",(function(){return K})),r.d(t,"d",(function(){return R})),r.d(t,"c",(function(){return te}))},5846:function(e,t,r){"use strict";var n=r(29),a=r(0);function o(e,t){var r;return void 0===e||e.__type||(r=e,e=Object(a.__assign)({__type:"DeleteFolderJsonRequest:#Exchange"},r)),Object(n.a)("DeleteFolder",e,t)}r.d(t,"a",(function(){return o}))},6518:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"IsNotEqualTo:#Exchange"},e)}},7260:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s}));var n=r(3),a=r(1671),o=Object(n.mutatorAction)("addToPendingFavoritesMap",(function(e){Object(a.b)().isFavoritingInProgress.set(e,!0)})),s=Object(n.mutatorAction)("removeFromPendingFavoritesMap",(function(e){Object(a.b)().isFavoritingInProgress.delete(e)}))},7261:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"CreateFolderJsonRequest:#Exchange"},e)}},7262:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"CreateFolderRequest:#Exchange"},e)}},7263:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(29),a=r(7261);function o(e,t){return void 0===e||e.__type||(e=Object(a.a)(e)),Object(n.a)("CreateFolder",e,t)}},8441:function(e,t,r){"use strict";var n=r(0),a=r(10254),o=r(1825),s=r(281),i=r(5796);t.a=Object(s.action)("synchronizeSearchFolder")((function(e,t,r){return Object(n.__awaiter)(this,void 0,void 0,(function(){var s,c,d,u,l,f;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return s=Object(o.getStore)(),(d=s.favoritePersonasRootFolderId)?[3,2]:[4,Object(i.c)()];case 1:d=n.sent(),n.label=2;case 2:return c=d,u={favoriteNodeId:e.id,displayName:e.displayName,allEmailAddresses:e.allEmailAddresses},[4,Object(i.f)(u,c,t,r)];case 3:return l=n.sent(),f=e.searchFolderId!==l.FolderId.Id,Object(a.a)(l),e.isSyncUpdateDone=!0,[2,f]}}))}))}))},9670:function(e,t,r){"use strict";var n=r(0),a=r(77),o=r(10253),s=r(11150),i=r(8441),c=r(2364),d=r(7260),u=r(266),l=r(1337),f=r(361),b=r(56),O=r(72),p=r(10255),j=r(1318),_=r(2365);function v(e,t,r,a){return e?function(e,t,r){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(n){if(!e)throw new Error("No persona id was provided.");return[2,g(e,null,t,r,"personaId",(function(){return Object(o.a)(e)}))]}))}))}(e,r,a):function(e,t,r){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(n){if(!e)throw new Error("No email address was provided.");return[2,g(null,e,t,r,"email",(function(){return Object(s.a)(e,t,!1)}))]}))}))}(t,r,a)}var g=Object(O.d)("AddFavoritePersona",c.a.AddFavoritePersonaAction)((function(e,t,r,a,o,s){return Object(n.__awaiter)(this,void 0,void 0,(function(){var a,o,c,O,v,g,F,y;return Object(n.__generator)(this,(function(I){switch(I.label){case 0:a=Object(j.getStore)(),o=t||e,c=!1,O=Object(f.a)(),I.label=1;case 1:if(I.trys.push([1,6,,7]),Object(_.a)(o))throw new Error("AddFavoritePersona - Favoriting is already in progress");if(d.a(o),c=!0,Object(j.isPersonaInFavorites)(e,t))throw new Error("AddFavoritePersona - Cannot add duplicate personas to favorites. Store already has persona before Persona resolution");return v=function(e,t,r){var n={id:e,type:1,displayName:t,mainEmailAddress:r,allEmailAddresses:r?[r]:[],searchFolderId:void 0,isSearchFolderPopulated:!1,isJustAdded:!0,isSyncUpdateDone:!0,dropViewState:Object(l.a)()},a=Object(j.getStore)();return a.favoritesPersonaNodes.set(e,n),a.orderedFavoritesNodeIds.push(e),n}(O,r,t),[4,h(r,t,s)];case 2:if((g=I.sent()).personaId&&Object(n.__spread)(a.favoritesPersonaNodes.values()).some((function(e){return e.personaId===g.personaId})))throw new Error("AddFavoritePersona - Cannot add duplicate personas to favorites. Store already has persona after Persona resolution.");return(F=function(e,t,r){(r.displayName||"")!==(t.displayName||"")&&Object(u.q)("AddFavoritePersona - DisplayName Mismatch");var a=Object(n.__assign)(Object(n.__assign)({},r),{displayName:t.displayName,mainEmailAddress:t.emailAddress,allEmailAddresses:t.emailAddresses,isJustAdded:!1});t.personaId&&(Object(u.q)("AddFavoritePersona - Contact found, storing personaId"),a.personaId=t.personaId);return Object(j.getStore)().favoritesPersonaNodes.set(e,a),a}(O,g,v)).mainEmailAddress?[4,Object(i.a)(F,"OnAdd").catch((function(e){throw new Error("AddFavoritePersona - synchronizeSearchFolder failed with error: "+(e||{}).toString())}))]:[3,4];case 3:I.sent(),I.label=4;case 4:return[4,Object(j.updateFavoritesUserOption)()];case 5:return I.sent(),setTimeout((function(){Object(p.b)(O)}),p.a),d.b(o),[2,F];case 6:throw y=I.sent(),function(e,t){var r=t.orderedFavoritesNodeIds.indexOf(e);r>-1&&t.orderedFavoritesNodeIds.splice(r,1);t.favoritesPersonaNodes.has(e)&&t.favoritesPersonaNodes.delete(e)}(O,a),c&&d.b(o),"AddFavoritePersonaFailure",b.g.warn("AddFavoritePersonaFailure: "+y),Object(u.q)("AddFavoritePersonaFailure",[y.toString()]),Object(n.__assign)({type:"AddFavoritePersonaError"},y);case 7:return[2]}}))}))}));function h(e,t,r){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return[4,r().then((function(r){return r?{displayName:r.DisplayName||e,personaId:r.PersonaId.Id,emailAddress:r.EmailAddress&&F(r.EmailAddress),emailAddresses:r.EmailAddresses&&r.EmailAddresses.map(F)||[]}:{displayName:e,personaId:void 0,emailAddress:t,emailAddresses:[t]}})).catch((function(e){throw new Error("AddFavoritePersona - resolvePersona failed with error: "+(e||{}).toString())}))];case 1:return[2,n.sent()]}}))}))}function F(e){return e.RoutingType&&"EX"===e.RoutingType.toUpperCase()?e.OriginalDisplayName:e.EmailAddress||e.OriginalDisplayName}function y(e,t,r,o){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return Object(a.i)("tri-favorites-roaming")?[4,j.lazyAddFavoritePersonaV2.import()]:[3,2];case 1:return n.sent()(t,r||t,o),[3,4];case 2:return[4,v(e,t,r,o)];case 3:return[2,n.sent()];case 4:return[2]}}))}))}r.d(t,"a",(function(){return y}))}}]);
//# sourceMappingURL=owa.MailBoot~MailFavoritesStore~MailFolderView.js.map
self.scriptsLoaded['owa.MailBoot~MailFavoritesStore~MailFolderView.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~MailFavoritesStore~MailFolderView.js'] = (new Date()).getTime();