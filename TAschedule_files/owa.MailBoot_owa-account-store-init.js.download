self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[811],{1243:function(e,n,t){"use strict";t.r(n);var r=t(0),o=t(96),c=t(676),u=t(389),i=t(1333),s=t(290),a=t(3046),d=t(443);var l={};function b(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,b,f,O;return Object(r.__generator)(this,(function(v){return t=e.userIdentity,b=Object(o.i)(t),f=l[t],b&&!f?[2,Promise.resolve()]:f?[2,f.requestPromise]:(O=function(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,l,b,f,O,v,j,p,S;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:t=e.userIdentity,l=e.accountProviderType,r.label=1;case 1:return r.trys.push([1,6,,7]),Object(u.d)(e),b=Object(s.d)(t),[4,Object(i.b)(Object(d.a)(b))];case 2:return f=r.sent(),O=Object(u.s)(t),f.headers&&O?[4,Object(a.a)(f)]:[3,4];case 3:return v=r.sent(),Object(o.x)(v,t),Object(c.c)(t,l),[3,5];case 4:j=f.headers?"Account invalid ":"Missing headers",Object(c.b)(t,n,l,j),r.label=5;case 5:return[3,7];case 6:return p=r.sent(),S="Exception"+p,Object(c.b)(t,n,l,S),[3,7];case 7:return[2]}}))}))}(e,n),l[t]={requestPromise:O},[2,O])}))}))}var f=t(2400),O=t(3),v=t(267),j=t(77),p=t(10),S=t(266);function w(e){return e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=30?{lowerBoundSeconds:0,upperBoundSeconds:30}:e<=60?{lowerBoundSeconds:30,upperBoundSeconds:60}:e<=300?{lowerBoundSeconds:60,upperBoundSeconds:300}:e<=600?{lowerBoundSeconds:300,upperBoundSeconds:600}:e<=1800?{lowerBoundSeconds:600,upperBoundSeconds:1800}:e<=3600?{lowerBoundSeconds:1800,upperBoundSeconds:3600}:e<=21600?{lowerBoundSeconds:3600,upperBoundSeconds:21600}:e<=43200?{lowerBoundSeconds:21600,upperBoundSeconds:43200}:e<=86400?{lowerBoundSeconds:43200,upperBoundSeconds:86400}:e>86400?{lowerBoundSeconds:86400,upperBoundSeconds:null}:{lowerBoundSeconds:null,upperBoundSeconds:null}}function A(e){switch(e.providerType){case f.c.Msa:case f.c.MsaInt:return!0;case f.c.Google:return Object(j.i)("cal-addCalendar-google");case f.c.TeamSnap:return!1;case f.c.ICloud:return Object(j.i)("cal-addCalendar-iCloud");default:return Object(v.a)(e.providerType)}}Object(O.orchestrator)(c.a,(function(){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var e,n,t,o;return Object(r.__generator)(this,(function(c){switch(c.label){case 0:return(e=Object(u.h)())==u.a.AccountsLoadSuccessful||e==u.a.Loading?[2]:(Object(u.w)(u.a.Loading),[4,f.e.importAndExecute()]);case 1:return n=c.sent(),t=n,o=null==n?void 0:n.isSuccess,t.ConnectedAccountResponses&&"function"==typeof t.ConnectedAccountResponses.filter?[4,Promise.all(t.ConnectedAccountResponses.filter(A).map((function(e){return Object(r.__awaiter)(void 0,void 0,void 0,(function(){var n,t;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=function(e){switch(e){case f.c.Msa:return"Outlook";case f.c.Google:return"Google";case f.c.ICloud:return"ICloud";default:return Object(v.a)(e)}}(e.providerType),t=parseInt(e.token.expiresIn),Object(S.q)("hasConnectedAccount",{tokenExpiry:t,type_1:n,tokenExpiryLowerBound_3:w(t).lowerBoundSeconds,tokenExpirtyUpperBound_4:w(t).upperBoundSeconds},{isCore:!0}),[4,b({userIdentity:e.userAccount.emailAddress,accountId:e.userAccount.id,accountUniqueId:e.userAccount.accountUniqueId,anchorMailbox:e.userAccount.routingHint,token:e.token.accessToken,tokenExpiry:Object(p.j)(Object(p.Pb)(),t),accountProviderType:n,accountState:u.b.Valid},!1)];case 1:return r.sent(),Object(u.l)(e.userAccount.emailAddress)!=u.b.Valid&&(o=!1),[2]}}))}))})))]:[3,3];case 2:c.sent(),c.label=3;case 3:return Object(u.e)(o),[2]}}))}))})),Object(O.orchestrator)(c.d,(function(e){var n=e.userIdentity;return Object(r.__awaiter)(void 0,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return Object(u.u)(n),Object(o.w)(n),Object(s.f)(n),function(e){delete l[e]}(n),[2]}))}))}));var h=t(1394);Object(O.orchestrator)(h.b,(function(e){b(Object(u.k)(e.userIdentity),!0)})),Object(O.orchestrator)(c.b,(function(e){var n=e.userIdentity,t=e.isRetry,r=e.accountProvider,o=e.error;(Object(S.q)("owaAccountStoreInitializationFailed",{error:o,accountProvider:r,isRetry:t},{isCore:!0}),t)?Object(u.x)(n,u.b.FailedToInitializeOWAConfig):b(Object(u.k)(n),!0)})),t.d(n,"initializeOwaAccountsStore",(function(){return c.a})),t.d(n,"removeOWAConnectedAccount",(function(){return c.d})),t.d(n,"owaAccountStoreInitializationFailed",(function(){return c.b})),t.d(n,"initializeOwaConnectedAccount",(function(){return b}))},1331:function(e,n,t){"use strict";function r(e,n){Object.keys(n).forEach((function(t){return e.set(t,n[t])}))}function o(e){var n=null!=e?e:{headers:new Headers};return n.datapoint=n.datapoint||{},n.datapoint.mailbox="Default",n}t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o}))},1333:function(e,n,t){"use strict";var r=t(0),o=t(1394),c=t(389),u=t(669),i=t(266),s=t(10),a="X-AnchorMailbox",d="Authorization",l="X-OwaWebSessionType",b="X-OWA-ExplicitLogonUser";function f(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,f,O,v,j;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(t={},f=Object(c.k)(e)){if(f.accountState==c.b.AccessRevoked)return[2,null];if(f.accountState==c.b.AccountDeprovisioned||f.accountState==c.b.AccountNotFound)return Object(c.c)(f.accountState,f.accountProviderType),[2,null]}return n?(t[a]=n,t[b]=n):f&&(t[a]=f.anchorMailbox),f?(O=f.token,!(v=Object(u.g)(f.tokenExpiry))&&O?[3,2]:(Object(i.q)("getAndUpdateAccessToken",{tokenExpiry:Object(s.y)(f.tokenExpiry,Object(s.Pb)()),isTokenExpired_1:v,isTokenInvalid_2:!O},{isCore:!0}),[4,o.a.importAndExecute(f.accountId,e,O)])):[3,3];case 1:(O=r.sent())||(O=""),r.label=2;case 2:j=void 0,"Outlook"==f.accountProviderType?(j='MSAuth1.0 usertoken="'+O+'", type="MSACT"',t[l]=1..toString()):"Google"!=f.accountProviderType&&"ICloud"!=f.accountProviderType||(j="Bearer "+O,t[l]=2..toString()),t[d]=j,r.label=3;case 3:return[2,t]}}))}))}var O=t(1331),v=t(56);function j(e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=Object(O.a)(),o=t,[4,p(e,n)];case 1:return o.headers=r.sent(),t.authNeededOnUnAuthorized=!1,t.datapoint=t.datapoint||{},t.datapoint.mailbox="Connected",[2,t]}}))}))}function p(e,n){var t;return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return o=n&&(null===(t=e.headers)||void 0===t?void 0:t.set)?new Headers(e.headers):new Headers,[4,f(e.mailboxInfo.userIdentity,S(e.mailboxInfo.type,e.mailboxInfo.mailboxSmtpAddress)?e.mailboxInfo.mailboxSmtpAddress:null)];case 1:return c=r.sent(),Object(O.b)(o,c),[2,o]}}))}))}function S(e,n){var t="GroupMailbox"==e||"TeamsMailbox"==e||"SharedMailbox"==e||"PublicMailbox"==e;return t&&null==n&&v.d("getHeadersForConnectedAccount: mailboxSmtpAddress should be passed for Group or Teams or Shared or Public Mbx request"),t}t.d(n,"a",(function(){return f})),t.d(n,"b",(function(){return j})),t.d(n,"c",(function(){return S}))},1334:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(3),o=Object(r.action)("triggerReInitializeAccount",(function(e){return{userIdentity:e}}))},1394:function(e,n,t){"use strict";t.d(n,"a",(function(){return u}));var r=t(74),o=t(1334);t.d(n,"b",(function(){return o.a}));var c=new r.c((function(){return t.e(1356).then(t.bind(null,1689))})),u=new r.a(c,(function(e){return e.getAndUpdateAccessToken}))},2164:function(e,n,t){"use strict";var r;t.d(n,"a",(function(){return r})),function(e){e[e.AccessRevoked=0]="AccessRevoked",e[e.AccountNotFound=1]="AccountNotFound",e[e.InvalidClient=2]="InvalidClient",e[e.InvalidCredentials=3]="InvalidCredentials",e[e.InvalidProvider=4]="InvalidProvider",e[e.MailboxDeprovisioned=5]="MailboxDeprovisioned",e[e.Transient=6]="Transient",e[e.PermissionDenied=7]="PermissionDenied",e[e.UserCancelled=8]="UserCancelled",e[e.AadAuth=9]="AadAuth",e[e.Unknown=10]="Unknown",e[e.ProviderUnavailable=11]="ProviderUnavailable",e[e.TooManyRequests=12]="TooManyRequests"}(r||(r={}))},2400:function(e,n,t){"use strict";var r=t(74),o=t(2504),c=t(2164),u=t(0),i=t(3172);function s(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){return Object(u.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(i.a)(e)];case 1:return[2,n.sent()]}}))}))}t.d(n,"g",(function(){return d})),t.d(n,"e",(function(){return l})),t.d(n,"h",(function(){return b})),t.d(n,"f",(function(){return f})),t.d(n,"i",(function(){return O})),t.d(n,"c",(function(){return o.b})),t.d(n,"a",(function(){return o.a})),t.d(n,"b",(function(){return c.a})),t.d(n,"d",(function(){return s}));var a=new r.c((function(){return Promise.all([t.e(0),t.e(1),t.e(2),t.e(4),t.e(7),t.e(18),t.e(23),t.e(812)]).then(t.bind(null,17215))})),d=new r.a(a,(function(e){return e.linkAccountAndGetAccessToken})),l=new r.a(a,(function(e){return e.getAllConnectedAccounts})),b=(new r.a(a,(function(e){return e.getConnectedAccount})),new r.a(a,(function(e){return e.addConnectedAccount})),new r.a(a,(function(e){return e.removeConnectedAccount}))),f=(new r.a(a,(function(e){return e.refreshConnectedAccountAccessToken})),new r.a(a,(function(e){return e.idpResponseHandler}))),O=new r.a(a,(function(e){return e.setAddConnectedAccountHandler}));"undefined"!=typeof window&&void 0!==window.Owa&&(window.Owa.lazyIdpResponseHandler=f)},2504:function(e,n,t){"use strict";var r,o;t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o})),function(e){e.Msa="Msa",e.TeamSnap="TeamSnap",e.MsaInt="MsaInt",e.Google="Google",e.ICloud="ICloud"}(r||(r={})),function(e){e.Active="Active",e.Revoked="Revoked",e.Error="Error"}(o||(o={}))},290:function(e,n,t){"use strict";var r=t(30),o=t(0),c=t(96),u=t(77);function i(e){var n=Object(c.i)(e);return n&&n.SessionSettings?0===n.SessionSettings.WebSessionType?Object(u.i)("doc-attachment-routingKeyAadSmtp")?"SMTP:":"":"MSA:":"no-routing-key:"}var s=t(56);function a(e,n,t){var r,c;if(t)try{for(var u=Object(o.__values)(t),i=u.next();!i.done;i=u.next()){var s=i.value;if(!d(e,s))return s}}catch(e){r={error:e}}finally{try{i&&!i.done&&(c=u.return)&&c.call(u)}finally{if(r)throw r.error}}return n&&n.length>0?n[0]:"NoResolvableAddress@invalid.outlook.com"}function d(e,n){return("outlook_"+e+"@outlook.com").toLowerCase()===n.toLowerCase()}function l(){var e=function(){var e=Object(r.a)();if(!e||!e.SessionSettings)return s.d("SessionSettings not available"),"no-routing-key";var n=e.SessionSettings.UserEmailAddress;if(0===e.SessionSettings.WebSessionType)return i()+n;if(Object(u.i)("doc-attachment-routingKeyPuid"))return"PUID:"+e.SessionSettings.UserPuid+"@"+e.SessionSettings.TenantGuid;if(e.SessionSettings.IsShadowMailbox)return i()+e.SessionSettings.LogonEmailAddress;if(d(e.HexCID,e.SessionSettings.UserEmailAddress))return i()+a(e.HexCID,e.SessionSettings.NotManagedEmailAddresses,e.SessionSettings.UserProxyAddresses);return i()+n}();return e=encodeURIComponent(e)}function b(){var e=Object(r.a)();if(!e||!e.SessionSettings)return s.d("SessionSettings not available"),"no-mailbox-id";var n=e.SessionSettings.UserEmailAddress;return Object(u.i)("doc-attachment-usePrimarySmtpAddressForMailboxId")?n:(e.SessionSettings.IsShadowMailbox?n=e.SessionSettings.LogonEmailAddress:d(e.HexCID,e.SessionSettings.UserEmailAddress)&&(n=a(e.HexCID,e.SessionSettings.NotManagedEmailAddresses,e.SessionSettings.UserProxyAddresses)),n)}var f=t(751),O=t(631);function v(e){var n=Object(O.a)().userMailboxInfoMap;n&&n.delete(e)}function j(e,n){return e===n||null!=e&&null!=n&&e.Id===n.Id}t.d(n,"c",(function(){return b})),t.d(n,"d",(function(){return f.a})),t.d(n,"f",(function(){return v})),t.d(n,"e",(function(){return j})),t.d(n,"a",(function(){return l})),t.d(n,"b",(function(){return i}))},3046:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(29);function o(e){return Object(r.a)("GetOwaUserConfiguration",{},e)}},3172:function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var r=t(0),o=t(11),c=t(319),u=t(2164),i=t(336),s=t(3173),a="ows/beta/ConnectedAccounts/refreshtoken/{0}";function d(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n=this;return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,Object(c.c)(Object(o.c)(a,e),null,void 0,!0).then((function(e){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n,t,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.json()];case 1:return n=r.sent(),t=n,Object(s.a)("refreshToken_serviceResponse",e,t),Object(i.a)(e.status)?[2,{ConnectedAccountResponse:n,isSuccess:!0}]:400==e.status||404==e.status?[2,{errorResponse:n,isSuccess:!1}]:429==e.status?(o=Number(e.headers.get("RetryAfter").slice(-2)),Object(s.b)(o,"refreshAccountToken"),[2,{errorResponse:{error:u.a[u.a.TooManyRequests]},isSuccess:!1,retryAfter:o}]):[2,{errorResponse:{error:u.a[u.a.Transient]},isSuccess:!1}]}}))}))})).catch((function(e){return{errorResponse:{error:u.a[u.a.Unknown],errorDescription:JSON.stringify(e)},isSuccess:!1}}))];case 1:return[2,t.sent()]}}))}))}},3173:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return u}));var r=t(266),o=t(336);function c(e,n,t){var c=Object(o.a)(n.status);Object(r.q)(e,{isSuccess_1:c,status_2:n.status,errorCode:c?null:JSON.stringify(null==t?void 0:t.error),errorDescription:c?null:JSON.stringify(null==t?void 0:t.errorDescription)},{isCore:!0})}function u(e,n){var t={lowerBoundSeconds:null,upperBoundSeconds:null};t=e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=1?{lowerBoundSeconds:0,upperBoundSeconds:1}:e<=2?{lowerBoundSeconds:1,upperBoundSeconds:2}:e<=5?{lowerBoundSeconds:2,upperBoundSeconds:5}:e<=10?{lowerBoundSeconds:5,upperBoundSeconds:10}:e<=30?{lowerBoundSeconds:10,upperBoundSeconds:30}:e>60?{lowerBoundSeconds:30,upperBoundSeconds:60}:{lowerBoundSeconds:null,upperBoundSeconds:null},Object(r.q)("ConnectedAccounts429Error",{retryAfterLowerBound_1:t.lowerBoundSeconds,retryAfterUpperBound_2:t.upperBoundSeconds,apiName_3:n})}},319:function(e,n,t){"use strict";t.d(n,"d",(function(){return c})),t.d(n,"c",(function(){return u})),t.d(n,"e",(function(){return i})),t.d(n,"b",(function(){return s})),t.d(n,"a",(function(){return a})),t.d(n,"f",(function(){return d}));var r=t(74),o=new r.c((function(){return Promise.all([t.e(3),t.e(23),t.e(878)]).then(t.bind(null,940))})),c=new r.a(o,(function(e){return e.makePostRequest})).importAndExecute,u=new r.a(o,(function(e){return e.makePatchRequest})).importAndExecute,i=new r.a(o,(function(e){return e.makePutRequest})).importAndExecute,s=new r.a(o,(function(e){return e.makeGetRequest})).importAndExecute,a=new r.a(o,(function(e){return e.makeDeleteRequest})).importAndExecute,d=new r.a(o,(function(e){return e.sendOwsPrimeRequest})).importAndExecute},336:function(e,n,t){"use strict";var r=t(732);t.d(n,"a",(function(){return r.a}))},443:function(e,n,t){"use strict";var r=t(0);function o(e,n){return e?Object(r.__assign)({mailboxInfo:e},n):null!=n?n:void 0}t.d(n,"a",(function(){return o}))},631:function(e,n,t){"use strict";var r=t(3),o=t(20);n.a=Object(r.createStore)("OWAClientIdStore",{userMailboxInfoMap:new o.ObservableMap})},669:function(e,n,t){"use strict";var r=t(3),o=Object(r.action)("initializeOwaObservableDateTime"),c=Object(r.action)("observableNowChanged"),u=Object(r.action)("observableTodayChanged"),i=t(10),s=t(20),a=Object(r.createStore)("ObservableDateTime",{now:0,today:0}),d=Object(s.computed)((function(){return Object(i.lc)(a().now)})),l=function(){return d.get()},b=Object(s.computed)((function(){return Object(i.lc)(a().today)})),f=function(){return b.get()},O=function(e){return Object(i.Gb)(e,l())},v=function(e){return Object(i.Eb)(e,l())},j=function(e){return S(e,i.Gb)},p=function(e){return S(e,i.Hb)},S=function(e,n){return n(Object(i.Wb)(Object(i.lc)(e)),f())};function w(e){if(!e)return"";var n=Object(i.lc)(e);return function(e,n){var t=Object(i.Wb)(e);if(Object(i.Ib)(t,n))return i.Z;var r=function(e){return Object(i.Mb)(t,Object(i.e)(n,-e),n)};if(r(3))return i.hb;if(r(30))return i.gb;return i.X}(n,f())(n)}function A(e){if(!e)return"";var n=Object(i.lc)(e);return function(e,n){var t=Object(i.Wb)(e);if(Object(i.Ib)(t,n))return i.S;return i.T}(n,f())(n)}function h(e){return e?function(e,n){var t=Object(i.Wb)(e);return Object(i.Ib)(t,n)?Object(i.Z)(e):g(t,n,2)?Object(i.kb)(e):g(t,n,7)?Object(i.H)(Object(i.ab)(e),Object(i.Z)(e)):Object(i.H)(Object(i.J)(e),Object(i.Z)(e))}(Object(i.lc)(e),f()):""}function g(e,n,t){return Object(i.Mb)(e,Object(i.e)(n,-t),n)}var m=Object(r.action)("updateTimes"),y=Object(r.action)("setNow"),I=Object(r.action)("setToday",(function(e){return{today:e}}));Object(r.mutator)(y,(function(){a().now=Object(i.jc)()})),Object(r.mutator)(I,(function(e){var n=e.today;a().today=n}));var _=t(34),x=t(127);Object(r.orchestrator)(o,(function(){m();var e=Object(i.Pb)(),n=Object(i.Yb)(Object(i.h)(e,1)),t=Object(i.w)(n,e);setTimeout((function(){return setInterval(m,_.g)}),t)})),Object(r.orchestrator)(x.l,(function(){m()})),Object(r.orchestrator)(m,(function(){y();var e=Object(i.zb)(Object(i.kc)()),n=a().today!=e;n&&I(e),c(),n&&u()})),t.d(n,"d",(function(){return o})),t.d(n,"j",(function(){return c})),t.d(n,"l",(function(){return u})),t.d(n,"i",(function(){return l})),t.d(n,"k",(function(){return f})),t.d(n,"g",(function(){return O})),t.d(n,"e",(function(){return v})),t.d(n,"f",(function(){return j})),t.d(n,"h",(function(){return p})),t.d(n,"a",(function(){return w})),t.d(n,"b",(function(){return A})),t.d(n,"c",(function(){return h}))},732:function(e,n,t){"use strict";function r(e){return e>=200&&e<300}t.d(n,"a",(function(){return r}))},751:function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r=t(96),o=t(631);function c(e){var n=Object(o.a)().userMailboxInfoMap;if(!n||!n.get(e)){var t=!1;e&&(t=e!=Object(r.b)());var c={type:"UserMailbox",userIdentity:t?e:Object(r.b)(),mailboxSmtpAddress:t?e:Object(r.c)()};return n.set(e,c),c}return n.get(e)}}}]);
//# sourceMappingURL=owa.MailBoot~owa-account-store-init.js.map
self.scriptsLoaded['owa.MailBoot~owa-account-store-init.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();